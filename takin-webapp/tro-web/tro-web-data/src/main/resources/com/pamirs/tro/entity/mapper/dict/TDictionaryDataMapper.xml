<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright 2021 Shulie Technology, Co.Ltd
  ~ Email: shulie@shulie.io
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pamirs.tro.entity.dao.dict.TDictionaryDataMapper">
    <resultMap id="BaseResultMap" type="com.pamirs.tro.entity.domain.entity.TDictionaryData">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <constructor>
            <idArg column="ID" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="DICT_TYPE" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="VALUE_ORDER" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="VALUE_NAME" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="VALUE_CODE" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="LANGUAGE" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="ACTIVE" jdbcType="CHAR" javaType="java.lang.String"/>
            <arg column="CREATE_TIME" jdbcType="DATE" javaType="java.util.Date"/>
            <arg column="MODIFY_TIME" jdbcType="DATE" javaType="java.util.Date"/>
            <arg column="CREATE_USER_CODE" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="MODIFY_USER_CODE" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="NOTE_INFO" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="VERSION_NO" jdbcType="BIGINT" javaType="java.lang.Long"/>
        </constructor>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, DICT_TYPE, VALUE_ORDER, VALUE_NAME, VALUE_CODE, LANGUAGE, ACTIVE, CREATE_TIME,
        MODIFY_TIME, CREATE_USER_CODE, MODIFY_USER_CODE, NOTE_INFO, VERSION_NO
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_dictionary_data
        where ID = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_dictionary_data
        where ID = #{id,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.pamirs.tro.entity.domain.entity.TDictionaryData">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_dictionary_data (ID, DICT_TYPE, VALUE_ORDER,
        VALUE_NAME, VALUE_CODE, LANGUAGE,
        ACTIVE, CREATE_TIME, MODIFY_TIME,
        CREATE_USER_CODE, MODIFY_USER_CODE, NOTE_INFO,
        VERSION_NO)
        values (#{id,jdbcType=VARCHAR}, #{dictType,jdbcType=VARCHAR}, #{valueOrder,jdbcType=INTEGER},
        #{valueName,jdbcType=VARCHAR}, #{valueCode,jdbcType=VARCHAR}, #{language,jdbcType=VARCHAR},
        #{active,jdbcType=CHAR}, now(), now(),
        #{createUserCode,jdbcType=VARCHAR}, #{modifyUserCode,jdbcType=VARCHAR}, #{noteInfo,jdbcType=VARCHAR},
        #{versionNo,jdbcType=BIGINT})
    </insert>
    <insert id="insertSelective" parameterType="com.pamirs.tro.entity.domain.entity.TDictionaryData">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_dictionary_data
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="dictType != null">
                DICT_TYPE,
            </if>
            <if test="valueOrder != null">
                VALUE_ORDER,
            </if>
            <if test="valueName != null">
                VALUE_NAME,
            </if>
            <if test="valueCode != null">
                VALUE_CODE,
            </if>
            <if test="language != null">
                LANGUAGE,
            </if>
            <if test="active != null">
                ACTIVE,
            </if>
            <if test="createTime != null">
                CREATE_TIME,
            </if>
            <if test="modifyTime != null">
                MODIFY_TIME,
            </if>
            <if test="createUserCode != null">
                CREATE_USER_CODE,
            </if>
            <if test="modifyUserCode != null">
                MODIFY_USER_CODE,
            </if>
            <if test="noteInfo != null">
                NOTE_INFO,
            </if>
            <if test="versionNo != null">
                VERSION_NO,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="dictType != null">
                #{dictType,jdbcType=VARCHAR},
            </if>
            <if test="valueOrder != null">
                #{valueOrder,jdbcType=INTEGER},
            </if>
            <if test="valueName != null">
                #{valueName,jdbcType=VARCHAR},
            </if>
            <if test="valueCode != null">
                #{valueCode,jdbcType=VARCHAR},
            </if>
            <if test="language != null">
                #{language,jdbcType=VARCHAR},
            </if>
            <if test="active != null">
                #{active,jdbcType=CHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=DATE},
            </if>
            <if test="modifyTime != null">
                #{modifyTime,jdbcType=DATE},
            </if>
            <if test="createUserCode != null">
                #{createUserCode,jdbcType=VARCHAR},
            </if>
            <if test="modifyUserCode != null">
                #{modifyUserCode,jdbcType=VARCHAR},
            </if>
            <if test="noteInfo != null">
                #{noteInfo,jdbcType=VARCHAR},
            </if>
            <if test="versionNo != null">
                #{versionNo,jdbcType=BIGINT},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.pamirs.tro.entity.domain.entity.TDictionaryData">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_dictionary_data
        <set>
            <if test="dictType != null">
                DICT_TYPE = #{dictType,jdbcType=VARCHAR},
            </if>
            <if test="valueOrder != null">
                VALUE_ORDER = #{valueOrder,jdbcType=INTEGER},
            </if>
            <if test="valueName != null">
                VALUE_NAME = #{valueName,jdbcType=VARCHAR},
            </if>
            <if test="valueCode != null">
                VALUE_CODE = #{valueCode,jdbcType=VARCHAR},
            </if>
            <if test="language != null">
                LANGUAGE = #{language,jdbcType=VARCHAR},
            </if>
            <if test="active != null">
                ACTIVE = #{active,jdbcType=CHAR},
            </if>
            <if test="createTime != null">
                CREATE_TIME = #{createTime,jdbcType=DATE},
            </if>
            <if test="modifyTime != null">
                MODIFY_TIME = #{modifyTime,jdbcType=DATE},
            </if>
            <if test="createUserCode != null">
                CREATE_USER_CODE = #{createUserCode,jdbcType=VARCHAR},
            </if>
            <if test="modifyUserCode != null">
                MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
            </if>
            <if test="noteInfo != null">
                NOTE_INFO = #{noteInfo,jdbcType=VARCHAR},
            </if>
            <if test="versionNo != null">
                VERSION_NO = #{versionNo,jdbcType=BIGINT},
            </if>
        </set>
        where ID = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.pamirs.tro.entity.domain.entity.TDictionaryData">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_dictionary_data
        set DICT_TYPE = #{dictType,jdbcType=VARCHAR},
        VALUE_ORDER = #{valueOrder,jdbcType=INTEGER},
        VALUE_NAME = #{valueName,jdbcType=VARCHAR},
        VALUE_CODE = #{valueCode,jdbcType=VARCHAR},
        LANGUAGE = #{language,jdbcType=VARCHAR},
        ACTIVE = #{active,jdbcType=CHAR},
        CREATE_TIME = #{createTime,jdbcType=DATE},
        MODIFY_TIME = #{modifyTime,jdbcType=DATE},
        CREATE_USER_CODE = #{createUserCode,jdbcType=VARCHAR},
        MODIFY_USER_CODE = #{modifyUserCode,jdbcType=VARCHAR},
        NOTE_INFO = #{noteInfo,jdbcType=VARCHAR},
        VERSION_NO = #{versionNo,jdbcType=BIGINT}
        where ID = #{id,jdbcType=VARCHAR}
    </update>

    <update id="updateDictionary" parameterType="com.pamirs.tro.entity.domain.vo.TDictionaryVo">
        UPDATE t_dictionary_type t, t_dictionary_data d
        SET
        <if test="typeName!=null and typeName!=''">
            t.TYPE_NAME = #{typeName},
        </if>
        <if test="typeAlias!=null and typeAlias!=''">
            t.TYPE_ALIAS = #{typeAlias},
        </if>
        <if test="typeActive!=null and typeActive!=''">
            t.ACTIVE = #{typeActive},
        </if>
        <if test="valueOrder!=null and valueOrder!=''">
            d.VALUE_ORDER = #{valueOrder},
        </if>
        <if test="valueName!=null and valueName!=''">
            d.VALUE_NAME = #{valueName},
        </if>
        <if test="valueCode!=null and valueCode!=''">
            d.VALUE_CODE = #{valueCode},
        </if>
        <if test="valueActive!=null and valueActive!=''">
            d.ACTIVE = #{valueActive},
        </if>
        d.MODIFY_TIME = now()
        WHERE
        t.ID = d.DICT_TYPE AND d.ID = #{valueId}
    </update>

    <!--数据字典结果集-->
    <resultMap id="DictionaryResultMap" type="com.pamirs.tro.entity.domain.vo.TDictionaryVo">
        <id column="valueId" property="valueId" jdbcType="VARCHAR" javaType="java.lang.String"></id>
        <result column="VALUE_CODE" property="valueCode" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="VALUE_ORDER" property="valueOrder" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="VALUE_NAME" property="valueName" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="valueActive" property="valueActive" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="CREATE_TIME" property="createTime" jdbcType="DATE" javaType="java.util.Date"></result>
        <result column="MODIFY_TIME" property="modifyTime" jdbcType="DATE" javaType="java.util.Date"></result>
        <result column="LANGUAGE" property="language" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="typeId" property="typeId" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="TYPE_NAME" property="typeName" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="typeActive" property="typeActive" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="TYPE_ALIAS" property="typeAlias" jdbcType="VARCHAR" javaType="java.lang.String"></result>
        <result column="IS_LEAF" property="isLeaf" jdbcType="VARCHAR" javaType="java.lang.String"></result>
    </resultMap>

    <!--查询数据字典列表-->
    <select id="queryDictionaryList" parameterType="map" resultMap="DictionaryResultMap">
        SELECT
        d.ID valueId,
        d.VALUE_ORDER,
        d.VALUE_CODE,
        d.VALUE_NAME,
        d.ACTIVE valueActive,
        d.CREATE_TIME,
        d.MODIFY_TIME,
        d.`LANGUAGE`,
        t.ID typeId,
        t.TYPE_NAME,
        t.ACTIVE typeActive,
        t.TYPE_ALIAS,
        t.IS_LEAF
        FROM
        t_dictionary_type t, t_dictionary_data d
        WHERE
        t.ID = d.DICT_TYPE
        <if test="typeName!=null and typeName!=''">
            AND t.TYPE_NAME LIKE CONCAT('%',#{typeName},'%')
        </if>
        <if test="typeAlias!=null and typeAlias!=''">
            AND t.TYPE_ALIAS LIKE CONCAT('%',#{typeAlias},'%')
        </if>
        <if test="valueName!=null and valueName!=''">
            AND d.VALUE_NAME LIKE CONCAT('%',#{valueName},'%')
        </if>
        <if test="valueActive!=null and valueActive!=''">
            AND d.ACTIVE = #{valueActive}
        </if>
        ORDER BY TYPE_ALIAS, VALUE_ORDER
    </select>

    <!--查询数据字典详情-->
    <select id="queryDictionaryDetail" parameterType="string"
            resultType="com.pamirs.tro.entity.domain.vo.TDictionaryVo">
        SELECT d.ID     valueId,
               d.VALUE_ORDER,
               d.VALUE_CODE,
               d.VALUE_NAME,
               d.ACTIVE valueActive,
               d.CREATE_TIME,
               d.MODIFY_TIME,
               d.`LANGUAGE`,
               t.ID     typeId,
               t.TYPE_NAME,
               t.ACTIVE typeActive,
               t.TYPE_ALIAS,
               t.IS_LEAF
        FROM t_dictionary_type t,
             t_dictionary_data d
        WHERE t.ID = d.DICT_TYPE
          AND d.ID = #{tDictionaryId}
    </select>

    <!--批量删除数据字典-->
    <delete id="deleteDictionary" parameterType="list">
        delete from t_dictionary_data where ID in
        <foreach collection="tDictionaryIds" item="tDictionaryId" separator="," open="(" close=")">
            #{tDictionaryId}
        </foreach>
    </delete>

    <!--当有数据字典类型，但没有字典值时，删除-->
    <delete id="deleteEmptyDictType">
        DELETE t
        FROM t_dictionary_type t
                 LEFT JOIN t_dictionary_data d ON t.ID = d.DICT_TYPE
        WHERE d.ID IS NULL
    </delete>
</mapper>
