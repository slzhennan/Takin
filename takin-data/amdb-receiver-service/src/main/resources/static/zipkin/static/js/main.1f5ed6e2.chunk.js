(this["webpackJsonpzipkin-lens"]=this["webpackJsonpzipkin-lens"]||[]).push([[0],{335:function(e,t,a){e.exports=a.p+"static/media/zipkin-logo.95e14668.png"},414:function(e,t,a){e.exports=a(709)},708:function(e,t,a){},709:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(14),c=a.n(s),i=a(325),o=a(17),l=a(779),d=a(770),m=a(41),u=a(33),p=a(53),h=a(36),g=a(787),b=a(20),f=a(22),v=a(25),E=a(26),y=a(790),k=a(769),S=a(755),x=a(756),O=a(771),T=a(772),w=a(190),j=a(749),I=a(794),N=a(11),C=a.n(N);function R(){const e=Object(f.a)(["\n  margin-left: ","px;\n"]);return R=function(){return e},e}const L=Object(j.a)(e=>Object(I.a)({root:{minHeight:64,paddingRight:e.spacing(2),paddingLeft:e.spacing(2),color:e.palette.grey[500],textDecoration:"none",borderTop:"2px solid transparent",borderBottom:"2px solid transparent",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{color:e.palette.grey[100]}},"root--selected":{color:e.palette.common.white,borderBottom:"2px solid ".concat(e.palette.common.white)}}));var D=({icon:e,title:t,path:a})=>{const n=L(),s=a===Object(h.f)().pathname;return r.a.createElement(p.b,{to:a,className:C()(n.root,{[n["root--selected"]]:s})},r.a.createElement(E.a,{icon:e,size:"lg"}),r.a.createElement(P,null,t))};const P=Object(b.b)(w.a).attrs({variant:"body1"})(R(),({theme:e})=>e.spacing(1.5));var _=a(711),A=a(358),z=a(754),M=a(134),B=a.n(M),F=a(331),q=a.n(F),V=a(132);const H={en:{"1 Result":"1 Result",Address:"Address",Annotations:"Annotations","Archive Trace":"Archive Trace","Change Language":"Change Language",Dependencies:"Dependencies","Dependencies Page":"Dependencies Page",Depth:"Depth","Download JSON":"Download JSON",Duration:"Duration","End Time":"End Time","Failed to load this file":"Failed to load this file",Filter:"Filter","Find a trace":"Find a trace",Limit:"Limit",None:"None","One Result":"One Result","Only V2 format is supported":"Only V2 format is supported","Parent ID":"Parent ID","Please select criteria in the search bar. Then, click the search button.":"Please select criteria in the search bar. Then, click the search button.","Please select the criteria for your trace lookup":"Please select the criteria for your trace lookup","Please select the start and end time. Then, click the search button.":"Please select the start and end time. Then, click the search button.","Relative Time":"Relative Time",Repository:"Repository",Root:"Root","Search Dependencies":"Search Dependencies","Search Traces":"Search Traces",'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.':'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.',"Service Name":"Service Name",Services:"Services","Span ID":"Span ID",Spans:"Spans","Start Time":"Start Time",Support:"Support",Tags:"Tags","This file does not contain JSON":"This file does not contain JSON","Total Spans":"Total Spans","Trace ID":"Trace ID","Upload JSON":"Upload JSON","View Logs":"View Logs",Zipkin:"Zipkin","Zipkin Home":"Zipkin Home","hide annotations":"hide annotations","show all annotations":"show all annotations","{0} Results":[["0"]," Results"]},es:{"1 Result":"1 Resultado",Address:"Direcci\xf3n",Annotations:"Anotaciones","Archive Trace":"Archivar Traza","Change Language":"Cambiar Idioma",Dependencies:"Dependencias","Dependencies Page":"P\xe1gina de Dependencies",Depth:"Profundidad","Download JSON":"Descargar JSON",Duration:"Duraci\xf3n","End Time":"Tiempo de Fin","Failed to load this file":"Fallo al cargar este archivo",Filter:"Filtro","Find a trace":"Encuentra un rastro",Limit:"L\xedmite",None:"Ninguno","One Result":"Un Resultado","Only V2 format is supported":"Solo el formato V2 es soportado","Parent ID":"ID de Traza Padre","Please select criteria in the search bar. Then, click the search button.":"Por favor, selecciona un criterio en la barra de b\xfasqueda. Luego, haz clic en el bot\xf3n buscar.","Please select the criteria for your trace lookup":"Por favor, selecciona el criterio para tu b\xfasqueda de trazas","Please select the start and end time. Then, click the search button.":"Por favor, selecciona el tiempo de inicio y fin. Luego, haz clic en el bot\xf3n buscar.","Relative Time":"Tiempo Relativo",Repository:"Repositorio",Root:"Ra\xedz","Search Dependencies":"Buscar Dependencias","Search Traces":"Buscar Trazas",'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.':'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.',"Service Name":"Nombre del Servicio",Services:"Servicios","Span ID":"ID de Tramo",Spans:"Tramos","Start Time":"Tiempo de Inicio",Support:"Soporte",Tags:"Etiquetas","This file does not contain JSON":"Este archivo no contiene JSON","Total Spans":"Tramos Totales","Trace ID":"ID de Traza","Upload JSON":"Subir JSON","View Logs":"Ver Logs",Zipkin:"Zipkin","Zipkin Home":"Zipkin Inicio","hide annotations":"ocultar anotaciones","show all annotations":"mostrar todas las anotaciones","{0} Results":[["0"]," Resultados"]},fr:{"1 Result":"1 R\xe9sultat",Address:"Adresse",Annotations:"Annotations","Archive Trace":"Trace Archiv\xe9e",Dependencies:"D\xe9pendances",Depth:"Profondeur","Download JSON":"T\xe9l\xe9charger JSON",Duration:"Dur\xe9e","End Time":"Fin","Find a trace":"Trouver une trace",Limit:"Limite",None:"Aucun","Parent ID":"ID Parent","Please select criteria in the search bar. Then, click the search button.":"S'il vous pla\xeet s\xe9lectionnez un crit\xe8re dans la barre de recherche. Puis cliquez sur le bouton de recherche","Please select the start and end time. Then, click the search button.":"S'il vous pla\xeet s\xe9lectionnez la date de d\xe9but et de fin. Puis cliquez sur le bouton de recherche","Relative Time":"Temps Relatif",Root:"Racine","Search Dependencies":"Rechercher les d\xe9pendances","Search Traces":"Rechercher les traces",'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.':'La recherche a \xe9t\xe9 d\xe9sactiv\xe9e via la propri\xe9t\xe9 searchEnabled. Vous pouvez toujours afficher des traces sp\xe9cifiques dont vous connaissez l\'identifiant de trace en le saisissant dans la zone de texte "ID Trace ... " en haut \xe0 droite.',Services:"Services","Span ID":"ID Section",Spans:"Sections","Start Time":"D\xe9but",Support:"Support",Tags:"\xc9tiquettes","Total Spans":"Sections Total","Trace ID":"ID Trace","Upload JSON":"Charger un JSON","View Logs":"Voir les journaux",Zipkin:"Zipkin","hide annotations":"masquer les annotations","show all annotations":"afficher toutes les annotations","{0} Results":[["0"]," R\xe9sultats"]},"zh-cn":{"1 Result":"1 \u6761\u7ed3\u679c",Address:"\u5730\u5740",Annotations:"Annotations","Archive Trace":"\u5b58\u6863Trace","Change Language":"\u6539\u53d8\u8bed\u8a00",Dependencies:"\u4f9d\u8d56","Dependencies Page":"\u4f9d\u8d56\u9875\u9762",Depth:"\u6df1\u5ea6","Download JSON":"\u4e0b\u8f7dJSON\u6570\u636e",Duration:"\u6301\u7eed\u65f6\u95f4","End Time":"\u7ec8\u6b62\u65f6\u95f4","Failed to load this file":"\u4e0b\u8f7d\u6587\u4ef6\u5931\u8d25",Filter:"\u8fc7\u6ee4","Find a trace":"\u627e\u5230\u4e00\u4e2a\u75d5\u8ff9",Limit:"\u6570\u91cf",None:"\u7a7a","One Result":"1\u6761\u7ed3\u679c","Only V2 format is supported":"\u4ec5\u652f\u6301V2\u683c\u5f0f","Parent ID":"Parent ID","Please select criteria in the search bar. Then, click the search button.":"\u8bf7\u5728\u641c\u7d22\u680f\u4e2d\u9009\u62e9\u6761\u4ef6\uff0c \u7136\u540e\u70b9\u51fb\u6309\u94ae\u8fdb\u884c\u67e5\u627e","Please select the criteria for your trace lookup":"\u8bf7\u9009\u62e9\u6761\u4ef6\u8fdb\u884ctrace\u67e5\u627e","Please select the start and end time. Then, click the search button.":"\u8bf7\u9009\u62e9\u8d77\u59cb\u65f6\u95f4\u548c\u7ec8\u6b62\u65f6\u95f4\uff0c \u7136\u540e\u70b9\u51fb\u6309\u94ae\u8fdb\u884c\u67e5\u627e","Relative Time":"\u76f8\u5bf9\u65f6\u95f4",Repository:"\u4ed3\u5e93",Root:"Root","Search Dependencies":"\u67e5\u8be2\u4f9d\u8d56","Search Traces":"\u67e5\u8be2trace\u94fe\u8def",'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.':'\u5df2\u901a\u8fc7searchEnabled\u5c5e\u6027\u7981\u7528\u641c\u7d22\uff0c\u901a\u8fc7\u5728\u53f3\u4e0a\u89d2\u7684 "Trace ID..."\u6587\u672c\u6846\u4e2d\u8f93\u5165trace id\uff0c\u60a8\u4ecd\u7136\u53ef\u4ee5\u67e5\u770b\u5df2\u77e5trace id\u7684\u8ddf\u8e2a\u4fe1\u606f',"Service Name":"\u670d\u52a1",Services:"\u670d\u52a1","Span ID":"Span ID",Spans:"Spans","Start Time":"\u5f00\u59cb\u65f6\u95f4",Support:"\u652f\u6301",Tags:"\u6807\u7b7e","This file does not contain JSON":"\u6b64\u6587\u4ef6\u4e0d\u5305\u542bJSON\u6570\u636e","Total Spans":"Span\u603b\u6570","Trace ID":"Trace ID","Upload JSON":"\u4e0a\u4f20JSON\u6570\u636e","View Logs":"\u67e5\u770b\u65e5\u5fd7",Zipkin:"Zipkin","Zipkin Home":"Zipkin Home","hide annotations":"\u9690\u85cfannotations","show all annotations":"\u663e\u793a\u5168\u90e8annotations","{0} Results":[["0"]," \u6761\u7ed3\u679c"]}};const U=Object(V.setupI18n)({messages:H,locale:function(){const e=localStorage.getItem("localeOverride");if(e)return e;const t=navigator.language.toLowerCase();if(Object.prototype.hasOwnProperty.call(H,t))return t;const a=t.indexOf("-");if(a>=0){const e=t.substring(0,a);if(Object.prototype.hasOwnProperty.call(H,e))return e}return"en"}(),localeData:{en:{},es:{},fr:{},zh:{}}}),Y=[{locale:"en",name:"English"},{locale:"es",name:"Espa\xf1ol"},{locale:"fr",name:"Fran\xe7ais"},{locale:"zh-cn",name:"\u4e2d\u6587 (\u7b80\u4f53)"}];var J=()=>{var e;const{i18n:t}=Object(o.useLingui)(),[a,s]=r.a.useState(null),c=Object(n.useCallback)(e=>{e.preventDefault(),s(e.currentTarget)},[]),i=Object(n.useCallback)(()=>{s(null)},[]),l=t.locale,d=Object(n.useCallback)(e=>{s(null);const{locale:t}=e.currentTarget.dataset;t&&t!==l&&(!function(e){localStorage.setItem("localeOverride",e)}(t),window.location.reload())},[l]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{onClick:c,startIcon:r.a.createElement(q.a,null),endIcon:r.a.createElement(B.a,null),"data-testid":"change-language-button"},null===(e=Y.find(e=>e.locale===l))||void 0===e?void 0:e.name),r.a.createElement(A.a,{anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:i},Y.map(e=>r.a.createElement(z.a,{key:e.locale,onClick:d,"data-locale":e.locale,"data-testid":"language-list-item-".concat(e.locale)},e.name))))},K=a(789);var W=()=>{const{i18n:e}=Object(o.useLingui)(),t=Object(h.e)(),[a,s]=Object(n.useState)(""),c=Object(n.useCallback)(e=>{s(e.target.value)},[]),i=Object(n.useCallback)(e=>{"Enter"===e.key&&t.push({pathname:"/traces/".concat(a)})},[t,a]);return r.a.createElement(K.a,{label:"Search by trace ID",value:a,onChange:c,onKeyDown:i,variant:"outlined",size:"small",placeholder:"".concat(e._(e._("Trace ID")),"...")})},Q=a(30);const Z=Object(Q.b)({name:"app",reducers:{clearAlert:e=>({...e,alertOpen:!1}),setAlert:(e,t)=>({...e,alert:t.payload,alertOpen:!0})},initialState:{alert:{message:"",severity:"info"},alertOpen:!1}});var G=Z;const{clearAlert:$,setAlert:X}=Z.actions,ee=(()=>{const e=document.getElementsByTagName("base");return 0===e.length?"/zipkin":e[0].getAttribute("href").replace(/\/+$/,"")})(),te="".concat(ee,"/api/v2"),ae="".concat(ee,"/config.json"),ne="".concat(te,"/services"),re="".concat(te,"/remoteServices"),se="".concat(te,"/spans"),ce="".concat(te,"/traces"),ie="".concat(te,"/trace"),oe="".concat(te,"/dependencies"),le="".concat(te,"/autocompleteKeys"),de="".concat(te,"/autocompleteValues"),{treeCorrectedForClockSkew:me,traceSummary:ue,traceSummaries:pe,detailedTraceSummary:he}=a(710),ge=Object(Q.a)("traces/search",async(e,t)=>{const a=new URLSearchParams(e),{search:n,traces:r}=t.getState().traces;if(n.prevQuery===a.toString())return{traces:r,traceSummaries:n.traceSummaries,query:a.toString()};const s=await fetch("".concat(ce,"?").concat(a.toString()));if(!s.ok)throw Error(s.statusText);const c=(await s.json()).reduce((e,t)=>{const[{traceId:a}]=t,n=me(t);return e[a]={rawTrace:t,skewCorrectedTrace:n},e},{}),i=pe(a.get("serviceName"),Object.keys(c).map(e=>ue(c[e].skewCorrectedTrace)));return{traces:c,traceSummaries:i,query:a.toString()}}),be=Object(Q.a)("traces/load",async(e,t)=>{const{traces:a}=t.getState().traces;if(a[e]){const{rawTrace:t,skewCorrectedTrace:n}=a[e];let{adjustedTrace:r}=a[e];if(r)return a[e];if(n)return r=he(n),{rawTrace:t,skewCorrectedTrace:n,adjustedTrace:r}}const n=await fetch("".concat(ie,"/").concat(e));if(!n.ok)throw Error(n.statusText);const r=await n.json(),s=me(r);return{rawTrace:r,skewCorrectedTrace:s,adjustedTrace:he(s)}}),fe=Object(Q.a)("traces/loadJson",async e=>{const t=await(e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=()=>{a(n.error)},n.readAsText(e)}))(e),a=JSON.parse(t);(e=>{if(!Array.isArray(e)||0===e.length)throw new Error("input is not a list");const[t]=e;if(!t.traceId||!t.id)throw new Error("List<Span> implies at least traceId and id fields");if(t.binaryAnnotations||!t.localEndpoint&&!t.remoteEndpoint&&!t.tags)throw new Error("v1 format is not supported. For help, contact https://gitter.im/openzipkin/zipkin")})(a);const[{traceId:n}]=a,r=me(a);return{traceId:n,trace:{rawTrace:a,skewCorrectedTrace:r,adjustedTrace:he(r)}}}),ve={traces:{},search:{isLoading:!1,error:void 0,prevQuery:void 0,traceSummaries:[]}},Ee=Object(Q.b)({name:"traces",initialState:ve,reducers:{clearSearch:e=>{e.search.isLoading=!1,e.search.error=void 0,e.search.prevQuery=void 0,e.search.traceSummaries=[]}},extraReducers:e=>{e.addCase(ge.pending,e=>{const t={...e.search,isLoading:!0,error:void 0};e.search=t}),e.addCase(ge.fulfilled,(e,t)=>{const{traces:a}=t.payload,n={...e.traces};Object.keys(a).forEach(e=>{n[e]=a[e]});const r={isLoading:!1,error:void 0,prevQuery:t.payload.query,traceSummaries:t.payload.traceSummaries};e.search=r,e.traces=n}),e.addCase(ge.rejected,(e,t)=>{const a={...e.search,isLoading:!1,error:t.error};e.search=a}),e.addCase(be.pending,(e,t)=>{const a=t.meta.arg,n={...e.traces};n[a]||(n[a]={}),n[a].isLoading=!0,n[a].error=void 0,e.traces=n}),e.addCase(be.fulfilled,(e,t)=>{const a=t.meta.arg,n={...e.traces};n[a]={...t.payload},n[a].isLoading=!1,n[a].error=void 0,e.traces=n}),e.addCase(be.rejected,(e,t)=>{const a=t.meta.arg,n={...e.traces};n[a].isLoading=!1,n[a].error=t.error,e.traces=n}),e.addCase(fe.fulfilled,(e,t)=>{const{traceId:a,trace:n}=t.payload,r={...e.traces};r[a]=n,e.traces=r})}});var ye=Ee;const{clearSearch:ke}=Ee.actions;function Se(){const e=Object(f.a)(["\n  display: none;\n"]);return Se=function(){return e},e}var xe=()=>{const e=Object(u.c)(),t=Object(h.e)(),a=Object(n.useRef)(null),s=Object(n.useCallback)(()=>{a.current&&a.current.click()},[]),c=Object(n.useCallback)(a=>{const[n]=a.target.files;e(fe(n)).then(Q.c).then(({traceId:e})=>{t.push({pathname:"/traces/".concat(e)})}).catch(t=>{e(X({message:"Failed to load file: ".concat(t.message),severity:"error"}))})},[e,t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Oe,{ref:a,onChange:c}),r.a.createElement(S.a,{title:r.a.createElement(o.Trans,{id:"Upload JSON"})},r.a.createElement(x.a,{onClick:s},r.a.createElement(E.a,{icon:v.o,size:"sm"}))))};const Oe=b.b.input.attrs({type:"file"})(Se());const Te=r.a.createContext(),we=(e=>{let t,a;return e.then(e=>{t=e},e=>{a=e}),{read(){if(a)throw a;if(t)return t;throw e}}})(fetch(ae).then(e=>e.json())),je={environment:"",queryLimit:10,defaultLookback:9e5,searchEnabled:!0,dependency:{lowErrorRate:.5,highErrorRate:.75,enabled:!0}},Ie=({children:e})=>{const t=we.read();return Object.keys(je).forEach(e=>{t[e]||(t[e]=je[e])}),r.a.createElement(Te.Provider,{value:t},e)},Ne=Te,Ce=Te.Consumer,Re=()=>Object(n.useContext)(Ne);var Le=a(356),De=a(184),Pe=a(183),_e=a(757),Ae=a(758),ze=a(182),Me=a(186),Be=a(759),Fe=a(760),qe=a(761),Ve=a(187),He=a(762),Ue=a(763),Ye=a(764),Je=a(765),Ke=a(185),We=a(766),Qe=a(767),Ze=a(181),Ge=a(768);const $e=Object(Le.a)({palette:{primary:{main:"#6a9fb5",contrastText:"#fff"}}}),Xe=Object(Le.a)({palette:{type:"dark",primary:{main:"#6a9fb5",contrastText:"#fff"}}}),et=[De.a,Pe.a,_e.a,Ae.a,ze.a,Me.a,Be.a,Fe.a,qe.a,Ve.a,He.a,Ue.a,Ye.a,Je.a,Ke.a,We.a,Qe.a,Ze.a,Ge.a],tt=et.map(e=>Object(Le.a)({palette:{primary:{main:e[500]}}})),at=e=>{const t=(e=>{let t=0;if(0===e.length)return t;for(let a=0;a<e.length;a+=1){t=(t<<5)-t+e.charCodeAt(a),t|=0}return Math.abs(t)})(e);return tt[t%et.length]},nt=e=>at(e).palette.primary.dark,rt=e=>{switch(e){case"transient":case"critical":return De.a[500];default:return $e.palette.primary.main}};var st=a(335),ct=a.n(st);function it(){const e=Object(f.a)(["\n  min-height: 64px;\n"]);return it=function(){return e},e}function ot(){const e=Object(f.a)(["\n  margin-left: ","px;\n  margin-right: ","px;\n"]);return ot=function(){return e},e}function lt(){const e=Object(f.a)(["\n  width: 42px;\n  height: 42px;\n"]);return lt=function(){return e},e}function dt(){const e=Object(f.a)(["\n  padding-left: 0;\n"]);return dt=function(){return e},e}function mt(){const e=Object(f.a)(["\n  background-color: ",";\n  z-index: 1300;\n"]);return mt=function(){return e},e}var ut=({children:e})=>{const{i18n:t}=Object(o.useLingui)(),a=Re();return r.a.createElement(y.a,{display:"flex"},r.a.createElement(k.a,null),r.a.createElement(pt,null,r.a.createElement(ht,null,r.a.createElement(y.a,{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(y.a,{width:64,height:64,display:"flex",justifyContent:"center",alignItems:"center"},r.a.createElement(gt,{alt:t._(t._("Zipkin"))})),r.a.createElement(bt,null,r.a.createElement("strong",null,"Zipkin")),r.a.createElement(y.a,{display:"flex",ml:3},r.a.createElement(D,{title:t._(t._("Find a trace")),path:"/",icon:v.k}),a.dependency.enabled&&r.a.createElement(D,{title:t._(t._("Dependencies")),path:"/dependency",icon:v.i}))),r.a.createElement(d.a,{theme:Xe},r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(J,null),r.a.createElement(y.a,{mr:2,ml:2},r.a.createElement(xe,null)),r.a.createElement(W,null),a.supportUrl&&r.a.createElement(y.a,{ml:1},r.a.createElement(S.a,{title:t._(t._("Support"))},r.a.createElement(x.a,{href:a.supportUrl},r.a.createElement(E.a,{icon:v.j}))))))))),r.a.createElement(y.a,{component:"main",width:"100%"},r.a.createElement(ft,null),e))};const pt=Object(b.b)(O.a).attrs({position:"fixed"})(mt(),({theme:e})=>e.palette.grey[800]),ht=Object(b.b)(T.a)(dt()),gt=b.b.img.attrs({src:ct.a})(lt()),bt=Object(b.b)(w.a).attrs({variant:"h5"})(ot(),({theme:e})=>e.spacing(2),({theme:e})=>e.spacing(2)),ft=b.b.div(it());var vt=a(788),Et=a(18),yt=a.n(Et),kt=a(47),St=a(778),xt=a(357),Ot=a(137),Tt=a(362),wt=a(773),jt=a(774),It=a(775),Nt=a(776),Ct=a(777),Rt=a(141);const Lt=Object(j.a)(e=>Object(I.a)({title:{overflowWrap:"break-word",flexGrow:1,minWidth:10},searchTracesButton:{display:"flex"},noDataMessage:{opacity:.8},tablePaper:{marginRight:e.spacing(2),marginLeft:e.spacing(2),maxHeight:180,overflowY:"auto",borderRadius:3},tableHeadCell:{top:0,position:"sticky",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px"),backgroundColor:e.palette.grey[200],zIndex:1},tableCell:{wordBreak:"break-all",padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px")}}));var Dt=Object(h.g)(({serviceName:e,targetEdges:t,sourceEdges:a,history:s})=>{const c=Lt(),i=Object(n.useCallback)(()=>{const t=new URLSearchParams;t.set("serviceName",e),s.push({pathname:"/",search:t.toString()})},[e,s]),o=[];return 0!==t.length&&o.push({title:"Uses",edges:t,selectNodeName:e=>e.target,formatter:e=>"This service uses ".concat(e," service").concat(e<=1?"":"s")}),0!==a.length&&o.push({title:"Used",edges:a,selectNodeName:e=>e.source,formatter:e=>"This service is used by ".concat(e," service").concat(e<=1?"":"s")}),r.a.createElement(y.a,{height:"100%",display:"flex",flexDirection:"column"},r.a.createElement(y.a,{pt:2,pb:1,pr:2,pl:2,bgcolor:"grey.200",color:"text.secondary",display:"flex",justifyContent:"space-between"},r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(y.a,{mr:.75},r.a.createElement(E.a,{icon:v.l,size:"lg",color:nt(e)})),r.a.createElement(w.a,{variant:"h5",className:c.title},e)),r.a.createElement(_.a,{variant:"outlined",onClick:i,"data-testid":"search-traces-button"},r.a.createElement(E.a,{icon:v.k}),r.a.createElement(y.a,{component:"span",ml:.75},"Traces"))),r.a.createElement(y.a,{height:100,flexGrow:1,bgcolor:"background.paper",borderColor:"divider",borderTop:1,paddingBottom:2,overflow:"auto"},o.map(e=>r.a.createElement(y.a,{display:"flex",flexDirection:"column"},r.a.createElement(y.a,{height:180,position:"relative"},r.a.createElement(y.a,{position:"absolute",top:15,left:15,display:"flex",alignItems:"center"},r.a.createElement(y.a,{color:"text.secondary"},r.a.createElement(w.a,{variant:"h6"},e.title)),r.a.createElement(y.a,{color:"text.hint",ml:1},"(traced requests)")),r.a.createElement(y.a,{position:"absolute",bottom:10,right:15},r.a.createElement(y.a,{color:"text.hint",ml:1},e.formatter(e.edges.length))),r.a.createElement(Rt.d,null,r.a.createElement(Rt.c,null,r.a.createElement(Rt.b,{data:e.edges.map(t=>({name:e.selectNodeName(t),value:t.metrics.normal+t.metrics.danger})),nameKey:"name",dataKey:"value",outerRadius:60},e.edges.map(t=>r.a.createElement(Rt.a,{key:e.selectNodeName(t),fill:nt(e.selectNodeName(t))})))))),r.a.createElement(Tt.a,{className:c.tablePaper},r.a.createElement(wt.a,null,r.a.createElement(jt.a,null,r.a.createElement(It.a,null,r.a.createElement(Nt.a,{className:c.tableHeadCell},"Service Name"),r.a.createElement(Nt.a,{className:c.tableHeadCell},"Call"),r.a.createElement(Nt.a,{className:c.tableHeadCell},"Error"))),r.a.createElement(Ct.a,null,e.edges.map(t=>r.a.createElement(It.a,null,r.a.createElement(Nt.a,{className:c.tableCell},r.a.createElement(E.a,{icon:v.l,color:nt(e.selectNodeName(t))}),r.a.createElement(y.a,{component:"span",ml:.5},e.selectNodeName(t))),r.a.createElement(Nt.a,{className:c.tableCell},t.metrics.normal),r.a.createElement(Nt.a,{className:c.tableCell},t.metrics.danger))))))))))}),Pt=a(349),_t=a.n(Pt);class At extends _t.a{componentWillUnmount(){this.vizceral.animate=()=>{},delete this.vizceral}}var zt=e=>r.a.createElement(At,e);const Mt=(e,t)=>!t||(e.name===t||(e.source.name===t||e.target.name===t)),Bt=(e,t)=>!t||(e.name===t||(e.incomingConnections.find(e=>e.source.name===t)||e.outgoingConnections.find(e=>e.target.name===t))),Ft={control:e=>({...e,width:"15rem"}),option:e=>({...e,cursor:"pointer"}),clearIndicator:e=>({...e,cursor:"pointer"}),dropdownIndicator:e=>({...e,cursor:"pointer"})},qt=Object(j.a)(e=>Object(I.a)({containerGrid:{height:"100%"},graphItemGrid:{height:"100%"},nodeDetailDataItemGrid:{height:"100%",boxShadow:e.shadows[10],zIndex:1},vizceralWrapper:{"& .vizceral":{height:"99%"}}}));var Vt=({dependencies:e})=>{const t=qt(),a=Object(kt.a)(),s={colorText:a.palette.primary.contrastText,colorTextDisabled:a.palette.primary.contrastText,colorConnectionLine:a.palette.grey[800],colorTraffic:{normal:a.palette.primary.dark,warning:a.palette.secondary.dark,danger:a.palette.secondary.dark},colorDonutInternalColor:a.palette.primary.light,colorDonutInternalColorHighlighted:a.palette.primary.light,colorLabelBorder:a.palette.primary.dark,colorLabelText:a.palette.primary.contrastText,colorTrafficHighlighted:{normal:a.palette.primary.main}},[c,i]=Object(n.useState)(""),[o,l]=Object(n.useState)(""),d=Object(n.useCallback)((e,t)=>{i(""),"clear"!==t.action?"select-option"===t.action&&e&&"value"in e&&l(e.value):l("")},[]),{nodes:m,edges:u,createdTs:p}=Object(n.useMemo)(()=>{const{nodes:t,edges:a}=(e=>{const t=[],a=[];return e.forEach(e=>{const n=t.map(e=>e.name);n.includes(e.parent)||t.push({name:e.parent}),n.includes(e.child)||t.push({name:e.child}),a.push({source:e.parent,target:e.child,metrics:{normal:e.callCount||0,danger:e.errorCount||0}})}),{nodes:t,edges:a}})(e);return{nodes:t,edges:a,createdTs:yt()().valueOf()}},[e]),h=Object(n.useMemo)(()=>c?u.filter(e=>e.source===c):[],[u,c]),g=Object(n.useMemo)(()=>c?u.filter(e=>e.target===c):[],[u,c]),b=Object(n.useCallback)(e=>{e?"node"===e.type&&e.getName()!==c&&i(e.getName()):i("")},[c]),f=Object(n.useMemo)(()=>u.length>0?u.map(e=>e.metrics.normal+e.metrics.danger).reduce((e,t)=>Math.max(e,t)):0,[u]),v=Object(n.useMemo)(()=>m.map(e=>({value:e.name,label:e.name})).sort((e,t)=>e.value.localeCompare(t.value)),[m]);return r.a.createElement(y.a,{width:"100%",height:"100%","data-testid":"dependencies-graph"},r.a.createElement(St.a,{container:!0,className:t.containerGrid},r.a.createElement(St.a,{item:!0,xs:c?7:12,className:t.graphItemGrid},r.a.createElement(Ot.a,null,({width:e,height:a})=>r.a.createElement(y.a,{width:e,height:a,position:"relative",className:t.vizceralWrapper},r.a.createElement(zt,{allowDraggingOfNodes:!0,targetFramerate:30,traffic:{renderer:"region",layout:"ltrTree",name:"dependencies-graph",maxVolume:50*f,nodes:m,connections:u,updated:p},objectHighlighted:b,styles:s,key:o,filters:[{name:"shownConnections",type:"connection",passes:Mt,value:o},{name:"shownNodes",type:"node",passes:Bt,value:o}]}))),r.a.createElement(y.a,{position:"absolute",left:30,top:30},r.a.createElement(xt.a,{isClearable:!0,options:v,onChange:d,value:o?{value:o,label:o}:void 0,styles:Ft}))),c?r.a.createElement(St.a,{item:!0,xs:5,className:t.nodeDetailDataItemGrid},r.a.createElement(Dt,{serviceName:c,targetEdges:h,sourceEdges:g})):null))};var Ht=r.a.memo(({icon:e,headerText:t,text:a})=>r.a.createElement(y.a,{top:64,left:0,right:0,bottom:0,position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",color:"text.secondary",zIndex:-1},r.a.createElement(E.a,{icon:e,size:"10x"}),r.a.createElement(y.a,{mt:3,mb:2},r.a.createElement(w.a,{variant:"h4"},t)),r.a.createElement(w.a,{variant:"body1"},a)));const Ut=Object(Q.a)("dependencies/fetch",async e=>{const t=new URLSearchParams;e.lookback&&t.set("lookback",e.lookback.toString()),t.set("endTs",e.endTs.toString());const a=await fetch("".concat(oe,"?").concat(t.toString()));if(!a.ok)throw Error(a.statusText);return await a.json()}),Yt={isLoading:!1,dependencies:[],error:void 0},Jt=Object(Q.b)({name:"dependencies",initialState:Yt,reducers:{clearDependencies:e=>{e.isLoading=!1,e.dependencies=[],e.error=void 0}},extraReducers:e=>{e.addCase(Ut.pending,e=>{e.isLoading=!0,e.dependencies=[],e.error=void 0}),e.addCase(Ut.fulfilled,(e,t)=>{e.isLoading=!1,e.dependencies=t.payload,e.error=void 0}),e.addCase(Ut.rejected,(e,t)=>{e.isLoading=!1,e.dependencies=[],e.error=t.error})}}),{clearDependencies:Kt}=Jt.actions;var Wt=Jt,Qt=a(351);const Zt=()=>{const e=Object(kt.a)();return r.a.createElement(y.a,{display:"flex",justifyContent:"center",mt:10,mb:10,"data-testid":"loading-indicator"},r.a.createElement(Qt.ScaleLoader,{color:e.palette.primary.light}))},Gt=Object(j.a)(e=>Object(I.a)({dateTimePicker:{marginLeft:e.spacing(1),marginRight:e.spacing(1)},dateTimePickerInput:{fontSize:"1rem",height:"1.8rem",padding:"".concat(e.spacing(.4),"px ").concat(e.spacing(.6),"px")},searchButton:{fontSize:"1.2rem",padding:e.spacing(1),minWidth:0,width:32,height:32}}));var $t=Object(h.g)(({history:e,location:t})=>{const a=Gt(),{i18n:s}=Object(o.useLingui)(),c=Object(u.c)(),{timeRange:i,setTimeRange:l}=((e,t)=>{const a=Object(n.useCallback)(a=>{const n=new URLSearchParams(t.search);n.set("startTime",a.startTime.valueOf().toString()),n.set("endTime",a.endTime.valueOf().toString()),e.push({pathname:t.pathname,search:n.toString()})},[e,t.pathname,t.search]);return{timeRange:Object(n.useMemo)(()=>{const e=new URLSearchParams(t.search),a=e.get("startTime");let n;a&&(n=yt()(parseInt(a,10)));const r=e.get("endTime");let s;return r&&(s=yt()(parseInt(r,10))),{startTime:n,endTime:s}},[t.search]),setTimeRange:a}})(e,t),[d,m]=Object(n.useState)({startTime:i.startTime?i.startTime:yt()().subtract({days:1}),endTime:i.endTime?i.endTime:yt()()});(e=>{const t=Object(u.c)();Object(n.useEffect)(()=>{if(!e.startTime||!e.endTime)return void t(Kt());const a=e.endTime.diff(e.startTime);t(Ut({lookback:a,endTs:e.endTime.valueOf()}))},[t,e.endTime,e.startTime])})(i);const{isLoading:p,dependencies:h,error:g}=Object(u.d)(e=>e.dependencies);Object(n.useEffect)(()=>{c(g?X({message:"Failed to load dependencies...",severity:"error"}):$())},[g,c]);const b=Object(n.useCallback)(e=>{e&&m({...d,startTime:e})},[d]),f=Object(n.useCallback)(e=>{e&&m({...d,endTime:e})},[d]),k=Object(n.useCallback)(()=>{l(d)},[l,d]);let S;return Object(n.useEffect)(()=>()=>{c(Kt())},[c]),S=p?r.a.createElement(Zt,null):h.length>0?r.a.createElement(Vt,{dependencies:h}):r.a.createElement(Ht,{icon:v.i,headerText:r.a.createElement(o.Trans,{id:"Search Dependencies"}),text:r.a.createElement(o.Trans,{id:"Please select the start and end time. Then, click the search button."})}),r.a.createElement(y.a,{width:"100%",height:"calc(100vh - 64px)",display:"flex",flexDirection:"column"},r.a.createElement(y.a,{bgcolor:"background.paper",boxShadow:3,p:3},r.a.createElement(y.a,{display:"flex",justifyContent:"center",alignItems:"center"},r.a.createElement(vt.a,{label:s._(s._("Start Time")),inputVariant:"outlined",value:d.startTime,onChange:b,format:"MM/DD/YYYY HH:mm:ss",className:a.dateTimePicker,InputProps:{classes:{input:a.dateTimePickerInput}}}),"-",r.a.createElement(vt.a,{label:s._(s._("End Time")),inputVariant:"outlined",value:d.endTime,onChange:f,format:"MM/DD/YYYY HH:mm:ss",className:a.dateTimePicker,InputProps:{classes:{input:a.dateTimePickerInput}}}),r.a.createElement(_.a,{color:"primary",variant:"contained",onClick:k,className:a.searchButton,"data-testid":"search-button"},r.a.createElement(E.a,{icon:v.k})))),r.a.createElement(y.a,{m:4,flexGrow:1},S))}),Xt=a(784),ea=a(782),ta=a(785),aa=a(786),na=a(246),ra=a.n(na),sa=a(355),ca=a.n(sa),ia=a(791),oa=a(352),la=a.n(oa);const da=(e="",t="")=>({key:e,value:t,id:la.a.generate()});var ma=a(780),ua=a(753),pa=a(713),ha=a(781);const ga={6e4:"1m",3e5:"5m",9e5:"15m",18e5:"30m",36e5:"1h",72e5:"2h",108e5:"3h",216e5:"6h",432e5:"12h",864e5:"1d",1728e5:"2d",6048e5:"7d"},ba=[{duration:yt.a.duration({minutes:1}),value:"1m",display:"Last 1 minute"},{duration:yt.a.duration({minutes:5}),value:"5m",display:"Last 5 minutes"},{duration:yt.a.duration({minutes:15}),value:"15m",display:"Last 15 minutes"},{duration:yt.a.duration({minutes:30}),value:"30m",display:"Last 30 minutes"},{duration:yt.a.duration({hours:1}),value:"1h",display:"Last 1 hour"},{duration:yt.a.duration({hours:2}),value:"2h",display:"Last 2 hours"},{duration:yt.a.duration({hours:3}),value:"3h",display:"Last 3 hours"},{duration:yt.a.duration({hours:6}),value:"6h",display:"Last 6 hours"},{duration:yt.a.duration({hours:12}),value:"12h",display:"Last 12 hours"},{duration:yt.a.duration({days:1}),value:"1d",display:"Last 1 day"},{duration:yt.a.duration({days:2}),value:"2d",display:"Last 2 days"},{duration:yt.a.duration({days:7}),value:"7d",display:"Last 7 days"}].reduce((e,t)=>(e[t.value]=t,e),{}),fa=Object(j.a)(e=>Object(I.a)({root:{position:"absolute",top:45,right:0,height:420,width:600,zIndex:e.zIndex.modal},containerGrid:{height:"100%"},fixedLookbackItemGrid:{height:"100%",overflowY:"auto",borderRight:"1px solid ".concat(e.palette.divider)},list:{padding:0}}));var va=({close:e,onChange:t,lookback:a})=>{const s=fa(),[c,i]=Object(n.useState)(!1),o=Object(n.useCallback)(()=>{i(!0)},[]),l=Object(n.useCallback)(()=>{i(!1)},[]),d=Object(n.useCallback)(()=>{c||e()},[e,c]),[m,u]=Object(n.useState)((e=>"millis"===e.type?e.value:0)(a)),[p,h]=Object(n.useState)((e=>"range"===e.type?e.startTime:yt()().subtract(1,"h"))(a)),[g,b]=Object(n.useState)((e=>"range"===e.type?e.endTime:yt()())(a)),f=Object(n.useCallback)(e=>{u(parseInt(e.target.value,10))},[]),v=Object(n.useCallback)(e=>{e&&h(e)},[]),E=Object(n.useCallback)(e=>{e&&b(e)},[]),k=a=>()=>{t({type:"fixed",value:a,endTime:yt()()}),e()},S=Object(n.useCallback)(()=>{t({type:"millis",endTime:yt()(),value:m}),e()},[e,m,t]),x=Object(n.useCallback)(()=>{t({type:"range",startTime:p,endTime:g}),e()},[p,g,t,e]);return r.a.createElement(ma.a,{onClickAway:d},r.a.createElement(Tt.a,{elevation:5,className:s.root},r.a.createElement(St.a,{container:!0,className:s.containerGrid},r.a.createElement(St.a,{item:!0,xs:5,className:s.fixedLookbackItemGrid},r.a.createElement(ua.a,{className:s.list},["1m","5m","15m","30m","1h","2h","3h","6h","12h","1d","2d","7d"].map(e=>r.a.createElement(pa.a,{button:!0,onClick:k(e),key:e,"data-testid":"lookback-".concat(e)},r.a.createElement(ha.a,{primary:ba[e].display}))))),r.a.createElement(St.a,{item:!0,xs:7},r.a.createElement(y.a,{p:2},r.a.createElement(y.a,{fontSize:"1.1rem",color:"text.secondary",mb:2},"Millis Lookback"),r.a.createElement(K.a,{label:"Milliseconds",onChange:f,value:m.toString(),variant:"outlined",size:"small",type:"number",inputProps:{min:"0","data-testid":"millis-input"}}),r.a.createElement(y.a,{display:"flex",justifyContent:"flex-end",mt:1},r.a.createElement(_.a,{variant:"contained",color:"secondary",onClick:S,"data-testid":"millis-apply-button"},"Apply"))),r.a.createElement(y.a,{p:2,borderTop:1,borderColor:"divider"},r.a.createElement(y.a,{fontSize:"1.1rem",color:"text.secondary",mb:2},"Range Lookback"),r.a.createElement(y.a,{mb:2},r.a.createElement(vt.a,{label:"Start Time",inputVariant:"outlined",format:"MM/DD/YYYY HH:mm:ss",value:p,onChange:v,onOpen:o,onClose:l,"data-testid":"date-time-picker",size:"small",fullWidth:!0})),r.a.createElement(y.a,{mb:2},r.a.createElement(vt.a,{label:"End Time",inputVariant:"outlined",format:"MM/DD/YYYY HH:mm:ss",value:g,onChange:E,onOpen:o,onClose:l,"data-testid":"date-time-picker",size:"small",fullWidth:!0})),r.a.createElement(y.a,{display:"flex",justifyContent:"flex-end"},r.a.createElement(_.a,{variant:"contained",color:"secondary",onClick:x,"data-testid":"apply-button"},"Apply")))))))},Ea=a(793);function ya(){const e=Object(f.a)(["\n  padding-top: 2px;\n  padding-bottom: 2px;\n"]);return ya=function(){return e},e}function ka(){const e=Object(f.a)(["\n  margin-block-start: ","px;\n  margin-block-end: ","px;\n"]);return ka=function(){return e},e}function Sa(){const e=Object(f.a)(["\n  padding: 2px;\n  background-color: ",";\n  border: 1px solid ",";\n  border-radius: 3px;\n  box-sizing: border-box;\n  display: inline-block;\n  font-family: monospace;\n"]);return Sa=function(){return e},e}function xa(){const e=Object(f.a)(["\n  position: absolute;\n  top: 45px;\n  left: 0px;\n  right: 0px;\n  border-radius: 1px;\n  background-color: ",";\n  box-shadow: ",";\n  max-height: 300px;\n  overflow: auto;\n  z-index: ",";\n  padding: ","px;\n"]);return xa=function(){return e},e}const Oa=b.b.div(xa(),({theme:e})=>e.palette.background.paper,({theme:e})=>e.shadows[3],({theme:e})=>e.zIndex.modal,({theme:e})=>e.spacing(1)),Ta=b.b.code(Sa(),({theme:e})=>e.palette.grey[100],({theme:e})=>e.palette.grey[300]),wa=b.b.ul(ka(),({theme:e})=>e.spacing(.5),({theme:e})=>e.spacing(.5)),ja=b.b.li(ya());var Ia=({target:e})=>{let t;switch(e){case"minDuration":case"maxDuration":t=r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{variant:"h6"},"Examples"),r.a.createElement(wa,null,r.a.createElement(ja,null,r.a.createElement(Ta,null,e,"=10s"),"\xa0(Seconds)"),r.a.createElement(ja,null,r.a.createElement(Ta,null,e,"=10ms"),"\xa0(Milliseconds)"),r.a.createElement(ja,null,r.a.createElement(Ta,null,e,"=10us"),"\xa0(Microseconds)")),"If no units are specified, the number is treated as ",r.a.createElement(Ta,null,"us"),".",r.a.createElement(Ta,null,e,"=10")," is the same as ",r.a.createElement(Ta,null,e,"=10us"),".");break;case"tagQuery":t=r.a.createElement(r.a.Fragment,null,"Limit results to traces that include one or more tags. Tags are only searchable by their exact value. Use ",r.a.createElement(Ta,null," and ")," to combine terms.",r.a.createElement(Ta,null," or ")," is not supported.",r.a.createElement(w.a,{variant:"h6"},"Example"),r.a.createElement(wa,null,r.a.createElement(ja,null,r.a.createElement(Ta,null,"tagQuery=error and http.method=POST"))))}return r.a.createElement(Oa,null,t)};function Na(){const e=Object(f.a)(["\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-right: 12px;\n  padding-left: 12px;\n  border-left: ",";\n  cursor: pointer;\n  &:hover {\n    background-color: ",";\n  }\n"]);return Na=function(){return e},e}function Ca(){const e=Object(f.a)(["\n  list-style-type: none;\n  margin: 0px;\n  padding: 0px;\n  font-size: 1.1rem;\n"]);return Ca=function(){return e},e}function Ra(){const e=Object(f.a)(["\n  position: absolute;\n  top: 45px;\n  left: 0px;\n  right: 0px;\n  border-radius: 1px;\n  background-color: ",";\n  box-shadow: ",";\n  max-height: 300px;\n  overflow: auto;\n  z-index: ",";\n\n  ","\n"]);return Ra=function(){return e},e}const La=b.b.div(Ra(),({theme:e})=>e.palette.background.paper,({theme:e})=>e.shadows[3],({theme:e})=>e.zIndex.modal,({isLoading:e,theme:t})=>e?"\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: ".concat(t.spacing(1),"px;\n      "):""),Da=b.b.ul(Ca()),Pa=b.b.li(Na(),({isFocused:e,theme:t})=>"5px solid ".concat(e?t.palette.primary.main:"rgba(0, 0, 0, 0)"),({theme:e})=>e.palette.grey[300]);var _a=({suggestions:e,isLoadingSuggestions:t,suggestionIndex:a,onItemClick:s})=>{const c=Object(n.useRef)([]),i=e=>t=>{c.current[e]=t};return Object(n.useEffect)(()=>{-1!==a&&c.current[a].scrollIntoView(!1)},[a]),t?r.a.createElement(La,{isLoading:!0},r.a.createElement(l.a,{size:20})):r.a.createElement(La,{isLoading:!1},r.a.createElement(Da,null,e.map((e,t)=>r.a.createElement(Pa,{key:e,ref:i(t),isFocused:a===t,onClick:s(t)},e))))};function Aa(){const e=Object(f.a)(["\n  width: 350px;\n  height: 40px;\n  padding: 10px;\n  box-sizing: border-box;\n  font-size: 1.1rem;\n"]);return Aa=function(){return e},e}function za(){const e=Object(f.a)(["\n  height: 100%;\n  width: 30;\n  color: ",";\n  background-color: ",";\n  cursor: pointer;\n  border: none;\n  &:focus {\n    outline: none;\n  }\n"]);return za=function(){return e},e}function Ma(){const e=Object(f.a)(["\n  margin-right: ","px;\n  position: relative;\n  animation: 0.25s 0s both ",";\n  z-index: ",";\n"]);return Ma=function(){return e},e}function Ba(){const e=Object(f.a)(["\n  display: flex;\n  height: 40px;\n  border-radius: 3px;\n  box-shadow: ",";\n  overflow: hidden;\n  margin-right: ","px;\n  font-size: 1.1rem;\n  color: ",";\n  cursor: pointer;\n  & > *:hover {\n    opacity: 0.9;\n  }\n  animation: 0.25s 0s both ",";\n"]);return Ba=function(){return e},e}function Fa(){const e=Object(f.a)(["\n  0% { opacity: 0 }\n  30% { opacity: 0.1 }\n  70% { opacity: 0.9 }\n  100% { opacity: 1 }\n"]);return Fa=function(){return e},e}const qa=Object(b.c)(Fa()),Va=Object(b.b)(y.a)(Ba(),({theme:e})=>e.shadows[1],({theme:e})=>e.spacing(1),({theme:e})=>e.palette.common.white,qa),Ha=Object(b.b)(y.a)(Ma(),({theme:e})=>e.spacing(2),qa,({theme:e})=>e.zIndex.modal),Ua=b.b.button(za(),({theme:e})=>e.palette.common.white,({theme:e})=>e.palette.primary.main),Ya=b.b.input.attrs(()=>({"data-testid":"criterion-input"}))(Aa()),Ja=e=>e.key?e.value?"".concat(e.key,"=").concat(e.value):"".concat(e.key,"="):"";var Ka=({criteria:e,criterion:t,criterionIndex:a,serviceNames:s,remoteServiceNames:c,spanNames:i,autocompleteKeys:o,autocompleteValues:l,isLoadingServiceNames:d,isLoadingRemoteServiceNames:m,isLoadingSpanNames:u,isLoadingAutocompleteValues:p,isFocused:h,onFocus:g,onBlur:b,onDecide:f,onChange:k,onDelete:S,loadAutocompleteValues:x})=>{const O=Object(n.useRef)(null),[T,w]=Object(n.useState)(Ja(t)),[j,I]=Object(n.useState)(Ja(t));Object(Ea.a)(()=>{O.current&&O.current.focus()});const N=Object(n.useRef)(h);Object(n.useLayoutEffect)(()=>{if(N.current&&!h){if(!j)return void S(a);let e=j.split("=");if(1===e.length||""===e[1])switch(e[0]){case"serviceName":case"spanName":case"remoteServiceName":case"maxDuration":case"minDuration":case"tagQuery":return I(""),void S(a)}e.length>2&&(e=j.split(/=(.+)/)),k(a,da(e[0],e[1]||""))}else!N.current&&h&&O.current&&O.current.focus();N.current=h},[h,j,k,S,a]);const[C,R]=Object(n.useMemo)(()=>{const e=j.split("=");return[e[0],e[1]||""]},[j]),L=!T.includes("="),D=Object(n.useMemo)(()=>{if(L)return!1;switch(C){case"serviceName":return d;case"spanName":return u;case"remoteServiceName":return m;default:if(o.includes(C))return p}return!1},[C,L,d,u,m,p,o]),P=Object(n.useMemo)(()=>{if(L){let a;return a=e.find(({key:e})=>"serviceName"===e)?["serviceName","spanName","remoteServiceName","maxDuration","minDuration","tagQuery",...o]:["serviceName","maxDuration","minDuration","tagQuery",...o],a.filter(a=>!e.find(e=>e.key===a)||t.key===a).filter(e=>e.includes(C))}let a;switch(C){case"serviceName":a=s;break;case"spanName":a=i;break;case"remoteServiceName":a=c;break;default:if(o.includes(C)){a=l;break}return}return a.filter(e=>e.includes(R))},[o,l,s,i,c,L,C,R,e,t]);Object(n.useEffect)(()=>{o.includes(C)&&x(C)},[C,o,x]);const[_,A]=Object(n.useState)(-1),z=Object(n.useCallback)(e=>{w(e.target.value),I(e.target.value),A(-1)},[]),M=Object(n.useCallback)(e=>{switch(e.key){case"Enter":if(e.preventDefault(),L){if(!T)return void f(a);const e="".concat(T,"=");w(e),I(e),A(-1)}else I(T),A(-1),f(a);break;case"ArrowUp":{if(e.preventDefault(),D||!P||0===P.length||!(_>0))break;const t=_-1;A(t),w(L?P[t]:"".concat(C,"=").concat(P[t]));break}case"ArrowDown":case"Tab":{if(e.preventDefault(),D||!P||0===P.length)break;let t;t=_===P.length-1?0:_+1,A(t),w(L?P[t]:"".concat(C,"=").concat(P[t]));break}case"Escape":f(a)}},[L,T,f,a,D,P,_,C]),B=Object(n.useCallback)(e=>{e.stopPropagation(),S(a)},[S,a]),F=Object(n.useCallback)(()=>{g(a)},[a,g]);return h?r.a.createElement(ma.a,{onClickAway:b},r.a.createElement(Ha,null,r.a.createElement(Ya,{ref:O,value:T,onKeyDown:M,onChange:z}),(D||P&&0!==P.length)&&r.a.createElement(_a,{suggestions:P||[],isLoadingSuggestions:D,suggestionIndex:_,onItemClick:e=>()=>{if(P)if(L){const t="".concat(P[e],"=");w(t),I(t),A(-1),O.current&&O.current.focus()}else{const t="".concat(C,"=").concat(P[e]);w(t),I(t),A(-1),f(a)}}}),!L&&("minDuration"===C||"maxDuration"===C||"tagQuery"===C)&&r.a.createElement(Ia,{target:C}))):r.a.createElement(Va,{onClick:F},r.a.createElement(y.a,{maxWidth:150,height:"100%",bgcolor:"primary.dark",p:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},t.key),t.value&&r.a.createElement(y.a,{maxWidth:200,height:"100%",bgcolor:"primary.main",p:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},t.value),r.a.createElement(Ua,{type:"button",onClick:B},r.a.createElement(E.a,{icon:v.n,size:"lg"})))};const Wa=Object(Q.a)("autocompleteValues/fetch",async e=>{const t=new URLSearchParams;t.set("key",e);const a=await fetch("".concat(de,"?").concat(t.toString()));if(!a.ok)throw Error(a.statusText);return await a.json()}),Qa={isLoading:!1,autocompleteValues:[],error:void 0};var Za=Object(Q.b)({name:"autocompleteValues",initialState:Qa,reducers:{},extraReducers:e=>{e.addCase(Wa.pending,e=>{e.isLoading=!0,e.autocompleteValues=[],e.error=void 0}),e.addCase(Wa.fulfilled,(e,t)=>{e.isLoading=!1,e.autocompleteValues=t.payload,e.error=void 0}),e.addCase(Wa.rejected,(e,t)=>{e.isLoading=!1,e.autocompleteValues=[],e.error=t.error})}});const Ga=Object(Q.a)("remoteServices/fetch",async e=>{const t=new URLSearchParams;t.set("serviceName",e);const a=await fetch("".concat(re,"?").concat(t.toString()));if(!a.ok)throw Error(a.statusText);return await a.json()}),$a={isLoading:!1,remoteServices:[],error:void 0};var Xa=Object(Q.b)({name:"remoteServices",initialState:$a,reducers:{},extraReducers:e=>{e.addCase(Ga.pending,e=>{e.isLoading=!0,e.remoteServices=[],e.error=void 0}),e.addCase(Ga.fulfilled,(e,t)=>{e.isLoading=!1,e.remoteServices=t.payload,e.error=void 0}),e.addCase(Ga.rejected,(e,t)=>{e.isLoading=!1,e.remoteServices=[],e.error=t.error})}});const en=Object(Q.a)("services/fetch",async()=>{const e=await fetch(ne);if(!e.ok)throw Error(e.statusText);return await e.json()}),tn={isLoading:!1,services:[],error:void 0};var an=Object(Q.b)({name:"services",initialState:tn,reducers:{},extraReducers:e=>{e.addCase(en.pending,e=>{e.isLoading=!0,e.services=[],e.error=void 0}),e.addCase(en.fulfilled,(e,t)=>{e.isLoading=!1,e.services=t.payload,e.error=void 0}),e.addCase(en.rejected,(e,t)=>{e.isLoading=!1,e.services=[],e.error=t.error})}});const nn=Object(Q.a)("spans/fetch",async e=>{const t=new URLSearchParams;t.set("serviceName",e);const a=await fetch("".concat(se,"?").concat(t.toString()));if(!a.ok)throw Error(a.statusText);return await a.json()}),rn={isLoading:!1,spans:[],error:void 0};var sn=Object(Q.b)({name:"spans",initialState:rn,reducers:{},extraReducers:e=>{e.addCase(nn.pending,e=>{e.isLoading=!0,e.spans=[],e.error=void 0}),e.addCase(nn.fulfilled,(e,t)=>{e.isLoading=!1,e.spans=t.payload,e.error=void 0}),e.addCase(nn.rejected,(e,t)=>{e.isLoading=!1,e.spans=[],e.error=t.error})}});const cn=Object(j.a)(e=>Object(I.a)({addButton:{height:40,width:40,minWidth:40,color:e.palette.common.white}}));var on=Object(u.b)(e=>({serviceNames:e.services.services,isLoadingServiceNames:e.services.isLoading,spanNames:e.spans.spans,isLoadingSpanNames:e.spans.isLoading,remoteServiceNames:e.remoteServices.remoteServices,isLoadingRemoteServiceNames:e.remoteServices.isLoading,autocompleteKeys:e.autocompleteKeys.autocompleteKeys,autocompleteValues:e.autocompleteValues.autocompleteValues,isLoadingAutocompleteValues:e.autocompleteValues.isLoading}),e=>({loadServices:()=>{e(en())},loadRemoteServices:t=>{e(Ga(t))},loadSpans:t=>{e(nn(t))},loadAutocompleteValues:t=>{e(Wa(t))}}))(({searchTraces:e,criteria:t,onChange:a,serviceNames:s,isLoadingServiceNames:c,spanNames:i,isLoadingSpanNames:o,remoteServiceNames:l,isLoadingRemoteServiceNames:d,autocompleteKeys:m,autocompleteValues:u,isLoadingAutocompleteValues:p,loadServices:h,loadRemoteServices:g,loadSpans:b,loadAutocompleteValues:f})=>{const k=cn(),[S,x]=Object(n.useState)(-1),O=e=>{x(e)},T=(e,n)=>{const r=[...t];r[e]=n,a(r)},w=()=>{x(-1)},j=e=>{const n=t.filter((t,a)=>a!==e);a(n),x(-1)},I=e=>{if(e===t.length-1){const e=[...t];e.push(da("","")),a(e);const n=t.length;x(n)}else x(-1)},N=Object(n.useCallback)(()=>{const e=[...t];e.push(da("","")),a(e);const n=t.length;x(n)},[t,a]);Object(n.useEffect)(()=>{h()},[]);const C=Object(n.useRef)("");Object(n.useEffect)(()=>{const e=t.find(e=>"serviceName"===e.key),a=e?e.value:"";a!==C.current&&(C.current=a,b(a),g(a))},[t,b,g]);const R=Object(n.useRef)(!1);R.current=-1!==S;const L=Object(n.useCallback)(t=>{setTimeout(()=>{document.activeElement&&(R.current||"BODY"!==document.activeElement.tagName||"Enter"!==t.key||e())},0)},[e]);return Object(n.useEffect)(()=>(window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)}),[L]),r.a.createElement(y.a,{minHeight:60,display:"flex",alignItems:"center",pr:2,pl:2,pt:1,pb:1,borderRadius:3,bgcolor:"background.paper",flexWrap:"wrap",borderColor:"grey.400",border:1},t.map((e,a)=>r.a.createElement(Ka,{key:e.id,criteria:t,criterion:e,criterionIndex:a,serviceNames:s,remoteServiceNames:l,spanNames:i,autocompleteKeys:m,autocompleteValues:u,isLoadingServiceNames:c,isLoadingRemoteServiceNames:d,isLoadingSpanNames:o,isLoadingAutocompleteValues:p,isFocused:a===S,onFocus:O,onBlur:w,onDecide:I,onChange:T,onDelete:j,loadAutocompleteValues:f})),r.a.createElement(_.a,{color:"secondary",variant:"contained",onClick:N,className:k.addButton,"data-testid":"add-button"},r.a.createElement(E.a,{icon:v.h,size:"lg"})))}),ln=a(783),dn=a(796),mn=a(354),un=a.n(mn),pn=a(353),hn=a.n(pn);const gn=e=>0===e||"undefined"===typeof e?"0ms":e<1e3?"".concat(e,"\u03bcs"):e<1e6?"".concat((e/1e3).toFixed(3),"ms"):"".concat((e/1e6).toFixed(3),"s"),bn=e=>"".concat((e=>yt()(e/1e3).format("MM/DD HH:mm:ss.SSS"))(e),"_").concat(e.toString().slice(-3));var fn=a(715);const vn=Object(fn.a)(e=>({paper:{overflow:"hidden",display:"flex",flexShrink:0},buttonBase:{height:"1.8rem",paddingRight:"0.5rem",paddingLeft:"0.5rem",display:"flex",alignItems:"center",color:e.palette.common.white,backgroundColor:e.palette.primary.dark},clickableButton:{cursor:"pointer",transition:e.transitions.create(["background-color"],{duration:e.transitions.duration.short}),"&:hover":{backgroundColor:e.palette.primary.main}}})),En={count:null,onClick:null,onDelete:null},yn=({serviceName:e,count:t,onClick:a,onDelete:s})=>{const c=vn(),i=Object(n.useMemo)(()=>"".concat(e).concat(t?" (".concat(t,")"):""),[t,e]),o=Object(n.useCallback)(()=>{a(e)},[a,e]);return r.a.createElement(Tt.a,{className:c.paper},r.a.createElement(y.a,{className:"".concat(c.buttonBase," ").concat(a?c.clickableButton:""),onClick:o,"data-test":"badge"},i),s?r.a.createElement(y.a,{className:"".concat(c.buttonBase," ").concat(c.clickableButton),onClick:s,"data-test":"delete-button"},r.a.createElement(E.a,{icon:v.n})):null)};yn.defaultProps=En;const kn=({serviceName:e,...t})=>{const a=at(e);return r.a.createElement(d.a,{theme:a},r.a.createElement(yn,Object.assign({serviceName:e},t)))};kn.defaultProps=En;var Sn=kn;function xn(){const e=Object(f.a)(["\n  display: flex;\n  flex-wrap: wrap;\n  & > * {\n    margin: ","px;\n  }\n"]);return xn=function(){return e},e}function On(){const e=Object(f.a)(["\n  margin-left: ","px;\n"]);return On=function(){return e},e}function Tn(){const e=Object(f.a)(["\n  padding-bottom: 0;\n  padding-top: 0;\n"]);return Tn=function(){return e},e}function wn(){const e=Object(f.a)(["\n  position: absolute;\n  background-color: ",";\n  opacity: 0.3;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: ","%;\n  border-top-right-radius: 3px;\n  border-bottom-right-radius: 3px;\n"]);return wn=function(){return e},e}function jn(){const e=Object(f.a)(["\n  margin-right: ","px;\n"]);return jn=function(){return e},e}function In(){const e=Object(f.a)(["\n  margin-right: ","px;\n  &::after {\n    content: ':';\n  }\n"]);return In=function(){return e},e}function Nn(){const e=Object(f.a)(["\n  & > * {\n    border-bottom: unset;\n  }\n"]);return Nn=function(){return e},e}var Cn=({traceSummary:e,toggleFilter:t,open:a,toggleOpen:s})=>{const c=yt()(e.timestamp/1e3),i=Object(n.useMemo)(()=>[...e.serviceSummaries].sort((e,t)=>t.spanCount-e.spanCount),[e.serviceSummaries]),o=Object(n.useCallback)(()=>{s(e.traceId)},[s,e.traceId]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Rn,null,r.a.createElement(Nt.a,null,r.a.createElement(x.a,{size:"small",onClick:o},a?r.a.createElement(hn.a,null):r.a.createElement(un.a,null))),r.a.createElement(Nt.a,null,r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(Ln,{variant:"body1"},e.root.serviceName),r.a.createElement(w.a,{variant:"body2",color:"textSecondary"},e.root.spanName))),r.a.createElement(Nt.a,null,r.a.createElement(y.a,{display:"flex",justifyContent:"flex-end",alignItems:"center"},r.a.createElement(Dn,null,c.fromNow()),r.a.createElement(w.a,{variant:"body2",color:"textSecondary","data-testid":"TraceSummaryRow-startTimeFormat"},"(",c.format("MM/DD HH:mm:ss:SSS"),")"))),r.a.createElement(Nt.a,{align:"right"},e.spanCount),r.a.createElement(Nt.a,{align:"right"},r.a.createElement(y.a,{position:"relative",width:"100%","data-testid":"TraceSummaryRow-duration"},gn(e.duration),r.a.createElement(Pn,{width:e.width,infoClass:e.infoClass}))),r.a.createElement(Nt.a,null,r.a.createElement(_.a,{variant:"contained",size:"small",component:p.b,to:"traces/".concat(e.traceId)},"Show"))),r.a.createElement(It.a,null,r.a.createElement(_n,null,r.a.createElement(ea.a,{in:a,timeout:"auto",unmountOnExit:!0},r.a.createElement(y.a,{margin:1},r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(w.a,{variant:"body1",color:"textSecondary"},"Trace ID:"),r.a.createElement(An,null,e.traceId)),r.a.createElement(zn,null,i.map(e=>r.a.createElement(Sn,{serviceName:e.serviceName,count:e.spanCount,onClick:t}))))))))};const Rn=Object(b.b)(It.a)(Nn()),Ln=Object(b.b)(w.a).attrs({variant:"body1"})(In(),({theme:e})=>e.spacing(1)),Dn=Object(b.b)(w.a).attrs({variant:"body2"})(jn(),({theme:e})=>e.spacing(1)),Pn=b.b.div(wn(),({infoClass:e})=>(e=>{switch(e){case"trace-error-transient":return rt("transient");case"trace-error-critical":return rt("critical");default:return rt("none")}})(e||""),({width:e})=>e),_n=Object(b.b)(Nt.a).attrs({colSpan:6})(Tn()),An=Object(b.b)(w.a).attrs({variant:"body1"})(On(),({theme:e})=>e.spacing(.5)),zn=b.b.div(xn(),({theme:e})=>e.spacing(.5));var Mn=({traceSummaries:e,toggleFilter:t,traceSummaryOpenMap:a,toggleTraceSummaryOpen:s})=>{const[c,i]=Object(n.useState)("desc"),[l,d]=Object(n.useState)("duration"),m=Object(n.useCallback)(e=>{const{cellkey:t}=e.currentTarget.dataset;!t||"duration"!==t&&"timestamp"!==t&&"spanCount"!==t||(t===l?i(e=>"asc"===e?"desc":"asc"):(i("desc"),d(t)))},[l]);return r.a.createElement(ln.a,null,r.a.createElement(wt.a,null,r.a.createElement(jt.a,null,r.a.createElement(It.a,null,r.a.createElement(Nt.a,null),r.a.createElement(Nt.a,null,r.a.createElement(o.Trans,{id:"Root"})),[{label:r.a.createElement(o.Trans,{id:"Start Time"}),key:"timestamp"},{label:r.a.createElement(o.Trans,{id:"Spans"}),key:"spanCount"},{label:r.a.createElement(o.Trans,{id:"Duration"}),key:"duration"}].map(({label:e,key:t})=>r.a.createElement(Nt.a,{key:t,align:"right",sortDirection:l===t&&c},r.a.createElement(dn.a,{active:l===t,direction:l===t?c:"asc","data-cellkey":t,onClick:m},e))),r.a.createElement(Nt.a,null))),r.a.createElement(Ct.a,null,e.sort((e,t)=>"asc"===c?e[l]-t[l]:t[l]-e[l]).map(e=>r.a.createElement(Cn,{key:e.traceId,traceSummary:e,toggleFilter:t,open:!!a[e.traceId],toggleOpen:s})))))};function Bn(){const e=Object(f.a)(["\n  flex-shrink: 0;\n  height: 60px;\n  min-width: 0px;\n  margin-left: ","px;\n"]);return Bn=function(){return e},e}function Fn(){const e=Object(f.a)(["\n  flex-shrink: 0;\n  height: 60px;\n  min-width: 60px;\n  color: ",";\n"]);return Fn=function(){return e},e}function qn(){const e=Object(f.a)(["\n  /* Align LookbackButton height with the TextField height. */\n  padding-top: 7.5px;\n  padding-bottom: 7.5px;\n"]);return qn=function(){return e},e}const Vn=(e,t,a,n)=>{const r={},s=[];switch(e.forEach(e=>{if("tagQuery"===e.key)s.push(e.value);else if(n.includes(e.key))e.value?s.push("".concat(e.key,"=").concat(e.value)):s.push(e.key);else if("minDuration"===e.key||"maxDuration"===e.key){const t=(e=>{const t=e.match(/^(\d+)(s|ms|us)?$/);if(t&&!(t.length<2)){if(2===t.length||"undefined"===typeof t[2])return parseInt(t[1],10);switch(t[2]){case"s":return 1e3*parseInt(t[1],10)*1e3;case"ms":return 1e3*parseInt(t[1],10);case"us":return parseInt(t[1],10);default:return}}})(e.value);t&&(r[e.key]=t.toString())}else r[e.key]=e.value}),s.length>0&&(r.annotationQuery=s.join(" and ")),r.endTs=t.endTime.valueOf().toString(),t.type){case"range":{const e=t.endTime.valueOf()-t.startTime.valueOf();r.lookback=e.toString();break}case"millis":r.lookback=t.value.toString();break;case"fixed":r.lookback=ba[t.value].duration.asMilliseconds().toString()}return r.limit=a.toString(),r};var Hn=({autocompleteKeys:e})=>{const{setQueryParams:t,criteria:a,lookback:s,limit:c}=(e=>{const t=Object(h.e)(),a=Object(h.f)(),r=Object(n.useCallback)((n,r,s)=>{const c=new URLSearchParams,i=[];switch(n.forEach(t=>{"tagQuery"===t.key?i.push(t.value):e.includes(t.key)?t.value?i.push("".concat(t.key,"=").concat(t.value)):i.push(t.key):c.set(t.key,t.value)}),i.length>0&&c.set("annotationQuery",i.join(" and ")),r.type){case"fixed":c.set("lookback",r.value),c.set("endTs",r.endTime.valueOf().toString());break;case"range":c.set("lookback","range"),c.set("endTs",r.endTime.valueOf().toString()),c.set("startTs",r.startTime.valueOf().toString());break;case"millis":c.set("lookback","millis"),c.set("endTs",r.endTime.valueOf().toString()),c.set("millis",r.value.toString())}c.set("limit",s.toString()),t.push({pathname:a.pathname,search:c.toString()})},[e,t,a.pathname]);return{setQueryParams:r,criteria:Object(n.useMemo)(()=>{const t=[];return new URLSearchParams(a.search).forEach((a,n)=>{switch(n){case"lookback":case"startTs":case"endTs":case"millis":case"limit":break;case"annotationQuery":{const n=[];a.split(" and ").forEach(a=>{const r=a.split("=");if(0===r.length)return;const[s,c]=r;e.includes(s)?t.push(da(s,c||"")):n.push(a)}),t.push(da("tagQuery",n.join(" and ")));break}default:t.push(da(n,a))}}),t},[e,a.search]),lookback:Object(n.useMemo)(()=>{const e=new URLSearchParams(a.search),t=e.get("lookback");if(t)switch(t){case"range":{const t=e.get("startTs"),a=e.get("endTs");if(!a||!t)return;return{type:"range",startTime:yt()(parseInt(t,10)),endTime:yt()(parseInt(a,10))}}case"millis":{const t=e.get("endTs"),a=e.get("millis");if(!t||!a)return;return{type:"millis",endTime:yt()(parseInt(t,10)),value:parseInt(a,10)}}default:{const a=ba[t];if(!a)return;const n=e.get("endTs");if(!n)return;return{type:"fixed",value:a.value,endTime:yt()(parseInt(n,10))}}}},[a.search]),limit:Object(n.useMemo)(()=>{const e=new URLSearchParams(a.search).get("limit");if(e)return parseInt(e,10)},[a.search])}})(e);((e,t,a,r)=>{const s=Object(u.c)();Object(n.useEffect)(()=>{if(!a||!r)return void s(ke());const n=Vn(t,a,r,e);s(ge(n))},[e,t,s,r,a])})(e,a,s,c);const[i,l]=Object(n.useState)(a),{defaultLookback:d,queryLimit:m}=Re(),[p,g]=Object(n.useState)(((e,t)=>{if(e)return e;const a=ga[t];return a?{type:"fixed",value:a,endTime:yt()()}:{type:"millis",value:t,endTime:yt()()}})(s,d)),[b,f]=Object(n.useState)(c||m),E=Object(n.useMemo)(()=>{switch(p.type){case"fixed":return ba[p.value].display;case"range":return"".concat(p.startTime.format("MM/DD/YYYY HH:mm:ss")," - ").concat(p.endTime.format("MM/DD/YYYY HH:mm:ss"));case"millis":return"".concat(p.value,"ms");default:return""}},[p]),k=Object(n.useCallback)(e=>{f(parseInt(e.target.value,10))},[]),S=Object(n.useCallback)(()=>{const e=i.filter(e=>!!e.key);"fixed"===p.type||"millis"===p.type?t(e,{...p,endTime:yt()()},b):t(e,p,b)},[t,i,p,b]),{isLoading:x,traceSummaries:O,error:T}=Object(u.d)(e=>e.traces.search),[j,I]=Object(n.useState)(!1),N=Object(n.useCallback)(()=>{I(e=>!e)},[]),C=Object(n.useCallback)(()=>{I(!1)},[]),[R,L]=Object(n.useState)(!1),D=Object(n.useCallback)(()=>{L(e=>!e)},[]),{filters:P,handleFiltersChange:A,filterOptions:z,toggleFilter:M}=(e=>{const[t,a]=Object(n.useState)([]),r=Object(n.useMemo)(()=>Array.from(e.reduce((e,t)=>(t.serviceSummaries.forEach(t=>{e.add(t.serviceName)}),e),new Set)),[e]),s=Object(n.useCallback)((e,t)=>{a(t)},[]),c=Object(n.useCallback)(e=>{if(t.includes(e))a(t.filter(t=>t!==e));else{const n=[...t];n.push(e),a(n)}},[t]);return{filters:t,handleFiltersChange:s,filterOptions:r,toggleFilter:c}})(O),{traceSummaryOpenMap:B,expandAll:F,collapseAll:q,toggleTraceSummaryOpen:V}=(e=>{const[t,a]=Object(n.useState)({});return{traceSummaryOpenMap:t,expandAll:Object(n.useCallback)(()=>{a(e.reduce((e,t)=>(e[t.traceId]=!0,e),{}))},[e]),collapseAll:Object(n.useCallback)(()=>{a({})},[]),toggleTraceSummaryOpen:Object(n.useCallback)(e=>{a(t=>{const a={...t};return a[e]=!a[e],a})},[])}})(O),H=Object(n.useMemo)(()=>O.filter(e=>{const t=new Set(e.serviceSummaries.map(e=>e.serviceName));return!P.find(e=>!t.has(e))}),[P,O]),U=Object(u.c)();let Y;return Object(n.useEffect)(()=>{if(T){let e="Failed to search";T.message&&(e+=": ".concat(T.message)),U(X({message:e,severity:"error"}))}},[U,T]),Y=x?r.a.createElement(Zt,null):0===O.length?r.a.createElement(Ht,{icon:v.k,headerText:r.a.createElement(o.Trans,{id:"Search Traces"}),text:r.a.createElement(o.Trans,{id:"Please select criteria in the search bar. Then, click the search button."})}):r.a.createElement(Tt.a,{elevation:3},r.a.createElement(Mn,{traceSummaries:H,toggleFilter:M,traceSummaryOpenMap:B,toggleTraceSummaryOpen:V})),r.a.createElement(y.a,{width:"100%",height:"calc(100vh - 64px)",display:"flex",flexDirection:"column"},r.a.createElement(y.a,{bgcolor:"background.paper",boxShadow:3,pt:2,pb:1.5,zIndex:1e3},r.a.createElement(Xt.a,null,r.a.createElement(y.a,{display:"flex"},r.a.createElement(y.a,{flexGrow:1,mr:1},r.a.createElement(on,{criteria:i,onChange:l,searchTraces:S})),r.a.createElement(Yn,{onClick:S},"Run Query"),r.a.createElement(Jn,{onClick:D,isOpening:R,"data-testid":"settings-button"},r.a.createElement(ca.a,null)))),r.a.createElement(ea.a,{in:R},r.a.createElement(y.a,{mt:1.5,mb:1.5},r.a.createElement(ta.a,null)),r.a.createElement(Xt.a,null,r.a.createElement(y.a,{display:"flex",alignItems:"center",justifyContent:"flex-end",mt:1.75},r.a.createElement(K.a,{label:r.a.createElement(o.Trans,{id:"Limit"}),type:"number",variant:"outlined",value:b,onChange:k,size:"small",inputProps:{"data-testid":"query-limit"}}),r.a.createElement(y.a,{ml:1,position:"relative"},r.a.createElement(Un,{onClick:N,isShowingLookbackMenu:j},E),j&&r.a.createElement(va,{close:C,onChange:g,lookback:p}))))),O.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(y.a,{mt:1.5,mb:1.5},r.a.createElement(ta.a,null)),r.a.createElement(Xt.a,null,r.a.createElement(y.a,{display:"flex",justifyContent:"space-between",alignItems:"center"},r.a.createElement(w.a,{variant:"h6"},1===H.length?r.a.createElement(o.Trans,{id:"1 Result"}):r.a.createElement(o.Trans,{id:"{0} Results",values:{0:H.length}})),r.a.createElement(y.a,{display:"flex"},r.a.createElement(aa.a,null,r.a.createElement(_.a,{onClick:F},"Expand All"),r.a.createElement(_.a,{onClick:q},"Collapse All")),r.a.createElement(y.a,{width:300,ml:2},r.a.createElement(ia.a,{multiple:!0,value:P,options:z,renderInput:e=>r.a.createElement(K.a,Object.assign({},e,{variant:"outlined",label:"Service filters",placeholder:"Service filters",size:"small"})),size:"small",onChange:A}))))))),r.a.createElement(y.a,{flexGrow:1,overflow:"auto",pt:3,pb:3},r.a.createElement(Xt.a,null,Y)))};const Un=Object(b.b)(({isShowingLookbackMenu:e,...t})=>r.a.createElement(_.a,Object.assign({variant:"outlined",startIcon:r.a.createElement(E.a,{icon:v.g}),endIcon:e?r.a.createElement(ra.a,null):r.a.createElement(B.a,null)},t)))(qn()),Yn=Object(b.b)(_.a).attrs({variant:"contained",color:"primary",startIcon:r.a.createElement(E.a,{icon:v.m})})(Fn(),({theme:e})=>e.palette.common.white),Jn=Object(b.b)(({isOpening:e,...t})=>r.a.createElement(_.a,Object.assign({variant:"outlined",endIcon:e?r.a.createElement(ra.a,null):r.a.createElement(B.a,null)},t)))(Bn(),({theme:e})=>e.spacing(1)),Kn=Object(Q.a)("autocompleteKeys/fetch",async()=>{const e=await fetch(le);if(!e.ok)throw Error(e.statusText);return await e.json()}),Wn={isLoading:!1,autocompleteKeys:[],error:void 0};var Qn=Object(Q.b)({name:"autocompleteKeys",initialState:Wn,reducers:{},extraReducers:e=>{e.addCase(Kn.pending,e=>{e.isLoading=!0,e.autocompleteKeys=[],e.error=void 0}),e.addCase(Kn.fulfilled,(e,t)=>{e.isLoading=!1,e.autocompleteKeys=t.payload,e.error=void 0}),e.addCase(Kn.rejected,(e,t)=>{e.isLoading=!1,e.autocompleteKeys=[],e.error=t.error})}});var Zn=Object(u.b)(e=>({autocompleteKeys:e.autocompleteKeys.autocompleteKeys,isLoadingAutocompleteKeys:e.autocompleteKeys.isLoading}),e=>({loadAutocompleteKeys:()=>{e(Kn())}}))(({autocompleteKeys:e,isLoadingAutocompleteKeys:t,loadAutocompleteKeys:a})=>{const s=Re();return Object(n.useEffect)(()=>{a()},[]),s.searchEnabled?t?r.a.createElement(y.a,{height:"100vh",width:"100%",top:0,position:"fixed",display:"flex",alignItems:"center",justifyContent:"center"},r.a.createElement(l.a,null)):r.a.createElement(Hn,{autocompleteKeys:e}):r.a.createElement(w.a,{variant:"body1"},r.a.createElement(o.Trans,{id:'Searching has been disabled via the searchEnabled property. You can still view specific traces of which you know the trace id by entering it in the "Trace ID..." textbox on the top-right.'}))}),Gn=a(116),$n=a.n(Gn),Xn=a(1),er=a.n(Xn);const tr=er.a.shape({key:er.a.string.isRequired,value:er.a.string.isRequired}),ar=er.a.arrayOf(tr),nr=er.a.shape({value:er.a.string.isRequired,timestamp:er.a.number.isRequired,endpoint:er.a.string.isRequired,relativeTime:er.a.string.isRequired}),rr=er.a.arrayOf(nr),sr=er.a.shape({spanId:er.a.string.isRequired,spanName:er.a.string.isRequired,parentId:er.a.string,childIds:er.a.arrayOf(er.a.string).isRequired,serviceName:er.a.string.isRequired,serviceNames:er.a.arrayOf(er.a.string).isRequired,timestamp:er.a.number.isRequired,duration:er.a.number,durationStr:er.a.string,tags:ar.isRequired,annotations:rr.isRequired,errorType:er.a.string.isRequired,depth:er.a.number.isRequired,width:er.a.number.isRequired,left:er.a.number.isRequired}),cr=er.a.arrayOf(sr),ir=er.a.shape({serviceName:er.a.string.isRequired,spanCount:er.a.number.isRequired}),or=er.a.arrayOf(ir),lr=er.a.shape({traceId:er.a.string.isRequired,timestamp:er.a.number.isRequired,duration:er.a.number.isRequired,durationStr:er.a.string.isRequired,servicePercentage:er.a.number,serviceSummaries:or.isRequired,infoClass:er.a.string,spanCount:er.a.number.isRequired,width:er.a.number.isRequired}),dr=(er.a.arrayOf(lr),er.a.shape({traceId:er.a.string.isRequired,spans:cr.isRequired,serviceNameAndSpanCounts:or.isRequired,duration:er.a.number.isRequired,durationStr:er.a.string.isRequired,rootSpan:er.a.shape({serviceName:er.a.string.isRequired,spanName:er.a.string.isRequired}).isRequired}),Object(fn.a)(e=>({root:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)},upperBox:{width:"100%",display:"flex",borderBottom:"1px solid ".concat(e.palette.grey[300]),paddingTop:e.spacing(1)},serviceNameAndSpanName:{display:"flex",alignItems:"center"},serviceName:{textTransform:"uppercase"},spanName:{color:e.palette.text.secondary},lowerBox:{marginTop:e.spacing(.5),marginBottom:e.spacing(.5)},traceInfo:{display:"flex",alignItems:"center"},traceInfoEntry:{marginRight:e.spacing(1),display:"flex"},traceInfoLabel:{fontWeight:"bold",color:e.palette.grey[600]},traceInfoValue:{fontWeight:"bold",marginLeft:e.spacing(.8)},actionButton:{fontSize:"0.7rem",lineHeight:1},actionButtonIcon:{marginRight:e.spacing(1)}}))),mr=r.a.memo(({traceSummary:e,rootSpanIndex:t})=>{const a=Object(u.c)(),s=dr(),{i18n:c}=Object(o.useLingui)(),i=Re(),l=i.logsUrl&&e?i.logsUrl.replace(/{traceId}/g,e.traceId):void 0,d=e?"".concat(ie,"/").concat(e.traceId):void 0,m=i.archivePostUrl&&e?i.archivePostUrl:void 0,p=i.archiveUrl&&e?i.archiveUrl.replace("{traceId}",e.traceId):void 0,h=Object(n.useCallback)(()=>{fetch("".concat(ie,"/").concat(e.traceId)).then(e=>{if(!e.ok)throw new Error("Failed to fetch trace from backend");return e.json()}).then(e=>{for(const t of e)if("parentId"in t===!1){const e=t.tags||{};e["zipkin.archived"]="true",t.tags=e;break}return e}).then(e=>fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).then(e=>{if(!e.ok||202!==e.status&&200===e.status)throw new Error("Failed to archive the trace");a(X(p?{message:"Archive successful! This trace is now accessible at ".concat(p),severity:"success"}:{message:"Archive successful!",severity:"success"}))}).catch(()=>{a(X({message:"Failed to archive the trace",severity:"error"}))})},[m,p,a,e]),g=e?r.a.createElement(y.a,{className:s.traceInfo},[{label:c._(c._("Duration")),value:e.durationStr},{label:c._(c._("Services")),value:e.serviceNameAndSpanCounts.length},{label:c._(c._("Depth")),value:e.depth},{label:c._(c._("Total Spans")),value:e.spans.length},{label:c._(c._("Trace ID")),value:0===t?e.traceId:"".concat(e.traceId," - ").concat(e.spans[t].spanId)}].map(e=>r.a.createElement(y.a,{key:e.label,className:s.traceInfoEntry},r.a.createElement(y.a,{className:s.traceInfoLabel},"".concat(e.label,":")),r.a.createElement(y.a,{className:s.traceInfoValue},e.value)))):r.a.createElement("div",null);return r.a.createElement(y.a,{className:s.root},r.a.createElement(y.a,{className:s.upperBox},e?r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{variant:"h5",className:s.serviceName},e.rootSpan.serviceName),r.a.createElement(w.a,{variant:"h5",className:s.spanName}," : ".concat(e.rootSpan.spanName))):null),r.a.createElement(St.a,{container:!0,className:s.lowerBox,justify:"space-between"},r.a.createElement(St.a,{item:!0,xs:8},g),r.a.createElement(St.a,{container:!0,item:!0,xs:4,justify:"flex-end",spacing:1},r.a.createElement(St.a,{item:!0},r.a.createElement(_.a,{variant:"outlined",className:s.actionButton,href:d,download:e&&"".concat(e.traceId,".json"),"data-testid":"download-json-link"},r.a.createElement(E.a,{icon:v.e,className:s.actionButtonIcon}),r.a.createElement(o.Trans,{id:"Download JSON"}))),l&&r.a.createElement(St.a,{item:!0},r.a.createElement(_.a,{variant:"outlined",className:s.actionButton,href:l,target:"_blank",rel:"noopener","data-testid":"view-logs-link"},r.a.createElement(E.a,{icon:v.f,className:s.actionButtonIcon}),r.a.createElement(o.Trans,{id:"View Logs"}))),m&&r.a.createElement(St.a,{item:!0},r.a.createElement(_.a,{variant:"outlined",className:s.actionButton,target:"_blank",rel:"noopener","data-testid":"archive-trace-link",onClick:h},r.a.createElement(E.a,{icon:v.f,className:s.actionButtonIcon}),r.a.createElement(o.Trans,{id:"Archive Trace"}))))))});mr.defaultProps={traceSummary:null,rootSpanIndex:0};var ur=mr;const pr=e=>10/(e+1),hr="translate(16,".concat(-10,")"),gr="translate(".concat(-8,",").concat(-8,")"),br=e=>30*e,fr=e=>br(e)+2,vr=e=>br(e)+15,Er=e=>e/100*70,yr=e=>28+e/100*70,kr=Object(fn.a)(e=>({line:{stroke:e.palette.grey[300],strokeWidth:"1px"},spanToggleButton:{cursor:"pointer",opacity:0,backgroundColor:e.palette.grey[300],"&:hover":{opacity:.1}},buttonIcon:{stroke:e.palette.grey[800],strokeWidth:2},spanToggleButtonInternal:{stroke:e.palette.grey[700],strokeWidth:1,fill:e.palette.common.white},serviceBadgeText:{textTransform:"uppercase"}}));var Sr=r.a.memo(({spans:e,depth:t,childrenHiddenSpanIds:a,onChildrenToggle:s})=>{const c=kr(),{horizontalLineDataList:i,verticalLineDataList:o,buttonDataList:l,serviceNameDataList:d}=Object(n.useMemo)(()=>((e,t)=>{const a=[],n=[],r=[],s=[],c=[];for(let i=0;i<e.length;i+=1){const o=e[i];if(0===a.length){a.push({index:i,depth:o.depth});continue}const l=a[a.length-1];if(l.depth<o.depth){const e=l;a.push({index:i,depth:o.depth}),n.push({x:e.depth,y:i}),c.push({x:o.depth,y:i,serviceName:o.serviceName}),t[o.spanId]&&s.push({x:o.depth,y:i,spanId:o.spanId,isClosed:!0})}else if(l.depth!==o.depth)if(l.depth>o.depth){const l=[];for(let e=a.length-1;e>=0&&!(a[e].depth<o.depth);e-=1)l.push(a.pop());const d=a[a.length-1];a.push({index:i,depth:o.depth}),n.push({x:d.depth,y:i}),c.push({x:o.depth,y:i,serviceName:o.serviceName}),t[o.spanId]&&s.push({x:o.depth,y:i,spanId:o.spanId,isClosed:!0});for(let t=0;t<l.length-1;t+=1)r.push({x:l[t+1].depth,y1:l[t].index,y2:l[t+1].index}),s.push({x:l[t+1].depth,y:l[t+1].index,spanId:e[l[t+1].index].spanId})}else;else{a.pop();const e=a[a.length-1];a.push({index:i,depth:o.depth}),n.push({x:e.depth,y:i}),c.push({x:o.depth,y:i,serviceName:o.serviceName}),t[o.spanId]&&s.push({x:o.depth,y:i,spanId:o.spanId,isClosed:!0})}}n.push({x:e[0].depth,y:0}),c.push({x:e[0].depth,y:0,serviceName:e[0].serviceName}),t[e[0].spanId]&&s.push({x:e[0].depth,y:0,spanId:e[0].spanId,isClosed:!0});for(let i=0;i<a.length-1;i+=1)r.push({x:a[i].depth,y1:a[i].index,y2:a[i+1].index}),s.push({x:a[i].depth,y:a[i].index,spanId:e[a[i].index].spanId});return{horizontalLineDataList:n,verticalLineDataList:r,buttonDataList:s,serviceNameDataList:c}})(e,a),[e,a]);return r.a.createElement("g",null,i.map(({x:e,y:a})=>r.a.createElement("line",{key:"".concat(e,"-").concat(a),x1:"".concat(e*pr(t),"%"),x2:"".concat(28,"%"),y1:vr(a),y2:vr(a),className:c.line})),d.map(({x:e,y:a,serviceName:n})=>r.a.createElement("g",{transform:hr,key:"".concat(e,"-").concat(a)},r.a.createElement("svg",{x:"".concat(e*pr(t),"%"),y:vr(a),width:"".concat(16,"%"),height:20},r.a.createElement("rect",{rx:3,ry:3,x:0,y:0,width:"100%",height:"100%",fill:nt(n)}),r.a.createElement("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fill:"white",className:c.serviceBadgeText},n)))),o.map(({x:e,y1:a,y2:n})=>r.a.createElement("line",{key:"".concat(e,"-").concat(a,"-").concat(n),x1:"".concat(e*pr(t),"%"),x2:"".concat(e*pr(t),"%"),y1:vr(a),y2:vr(n),className:c.line})),l.map(({x:e,y:a,spanId:n,isClosed:i})=>r.a.createElement("g",{key:n,transform:gr},r.a.createElement("rect",{rx:2,ry:2,x:"".concat(e*pr(t),"%"),y:vr(a),width:16,height:16,className:c.spanToggleButtonInternal}),r.a.createElement("svg",{x:"".concat(e*pr(t),"%"),y:vr(a),className:c.buttonIcon},r.a.createElement("line",{x1:0,x2:16,y1:8,y2:8}),i?r.a.createElement("line",{x1:8,x2:8,y1:0,y2:16}):null),r.a.createElement("rect",{rx:2,ry:2,x:"".concat(e*pr(t),"%"),y:vr(a),width:16,height:16,onClick:()=>s(n),className:c.spanToggleButton}))))});const xr=Object(fn.a)(e=>({line:{stroke:e.palette.grey[300],strokeWidth:"1px"},bar:{opacity:.8},row:{opacity:0,fill:e.palette.grey[500],cursor:"pointer","&:hover":{opacity:.2}},"row--focused":{opacity:.3},text:{fontSize:"1.03rem"}}));var Or=r.a.memo(({span:e,index:t,onRowClick:a,isFocused:s,startTs:c,endTs:i})=>{const o=xr(),{left:l,width:d}=Object(n.useMemo)(()=>((e,t,a,n)=>{const r=t-e;return a?{width:Math.max(a/r*100,.25),left:(n-e)/r*100}:0===r?{width:100,left:0}:{width:.25,left:(n-e)/r*100}})(c,i,e.duration,e.timestamp),[c,i,e.duration,e.timestamp]),m=Object(n.useCallback)(()=>a(e.spanId),[a,e.spanId]),u=e.durationStr?"[".concat(e.durationStr,"]"):"",p=i-e.timestamp>(i-c)/2;return r.a.createElement("g",null,r.a.createElement("line",{x1:"".concat(28,"%"),x2:"100%",y1:vr(t),y2:vr(t),className:o.line}),r.a.createElement("rect",{width:"".concat(Er(d),"%"),height:26,x:"".concat(yr(l),"%"),y:fr(t),rx:4,ry:4,className:o.bar,style:{fill:rt(e.errorType)}}),p?r.a.createElement("text",{x:"".concat(yr(l)+1,"%"),y:fr(t)+15,className:o.text},"".concat(e.spanName," ").concat(u)):r.a.createElement("text",{x:"".concat(yr(l)+Er(d)-1,"%"),y:fr(t)+15,textAnchor:"end",className:o.text},"".concat(e.spanName," ").concat(u)),r.a.createElement("rect",{className:C()(o.row,{[o["row--focused"]]:s}),x:0,y:br(t),width:"100%",height:30,onClick:m}))});const Tr=Object(fn.a)(e=>({line:{stroke:e.palette.grey[300],strokeWidth:"1px"}}));var wr=r.a.memo(()=>{const e=Tr(),t=[];for(let a=0;a<4;a+=1){const n=a/3,s=28+70*n;t.push(r.a.createElement("line",{key:n,x1:"".concat(s,"%"),x2:"".concat(s,"%"),y1:"0",y2:"100%",className:e.line}))}return r.a.createElement("g",null,t)});const jr={currentSpanId:er.a.string.isRequired,spans:cr.isRequired,depth:er.a.number.isRequired,childrenHiddenSpanIds:er.a.shape({}).isRequired,isRootedTrace:er.a.bool.isRequired,onRowClick:er.a.func.isRequired,onChildrenToggle:er.a.func.isRequired,startTs:er.a.number.isRequired,endTs:er.a.number.isRequired},Ir=r.a.memo(({currentSpanId:e,spans:t,depth:a,childrenHiddenSpanIds:n,isRootedTrace:s,onRowClick:c,onChildrenToggle:i,startTs:o,endTs:l})=>{return r.a.createElement("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"".concat((d=t.length,30*d),"px")},r.a.createElement(wr,null),t.map((t,a)=>r.a.createElement(Or,{key:t.spanId,span:t,onRowClick:c,index:a,isFocused:e===t.spanId,startTs:o,endTs:l})),s?r.a.createElement(Sr,{spans:t,depth:a,childrenHiddenSpanIds:n,onChildrenToggle:i}):null);var d});Ir.propTypes=jr;var Nr=Ir;const Cr=Object(fn.a)(e=>({marker:{height:"100%",width:"1px",backgroundColor:e.palette.grey[500],position:"absolute"},label:{fontSize:"0.8rem",left:"4px",position:"absolute"},"label--last":{left:"initial",right:"4px"}}));var Rr=r.a.memo(({startTs:e,endTs:t})=>{const a=Cr(),n=[];for(let s=0;s<4;s+=1){const c=e+s/3*(t-e),i=s/3;n.push(r.a.createElement(y.a,{key:i,position:"absolute",className:a.marker,style:{left:"".concat(100*i,"%")},"data-testid":"TimeMarker-marker"},r.a.createElement(y.a,{component:"span",position:"absolute",className:C()(a.label,{[a["label--last"]]:i>=1}),"data-testid":"TimeMarker-label"},gn(c))))}return r.a.createElement(y.a,{display:"flex"},r.a.createElement(y.a,{width:"".concat(28,"%")}),r.a.createElement(y.a,{mt:1,height:15,position:"relative",width:"".concat(70,"%")},n))});const Lr=Object(fn.a)(e=>({root:{borderBottom:"1px solid ".concat(e.palette.grey[300]),backgroundColor:e.palette.grey[100]},textButton:{fontSize:"1.2rem",minWidth:"2rem",width:"2rem"}}));var Dr=r.a.memo(({startTs:e,endTs:t,isRerooted:a,isRootedTrace:n,onResetRerootButtonClick:s,isSpanDetailOpened:c,onSpanDetailToggle:i,onCollapseButtonClick:o,onExpandButtonClick:l})=>{const d=Lr();return r.a.createElement(y.a,{className:d.root},r.a.createElement(y.a,{display:"flex",justifyContent:"space-between",mt:1,mr:1,ml:1},r.a.createElement(y.a,{display:"flex",alignItems:"center"},r.a.createElement(aa.a,null,r.a.createElement(_.a,{className:d.textButton,disabled:!n,onClick:o},r.a.createElement(E.a,{icon:v.d})),r.a.createElement(_.a,{className:d.textButton,disabled:!n,onClick:l},r.a.createElement(E.a,{icon:v.c}))),n&&a?r.a.createElement(y.a,{ml:1},r.a.createElement(_.a,{variant:"outlined",onClick:s},"Reset root")):null),r.a.createElement(_.a,{className:d.textButton,onClick:i},r.a.createElement(E.a,{icon:c?v.b:v.a}))),r.a.createElement(Rr,{startTs:e,endTs:t}))});const Pr=e=>"".concat(e.value,"-").concat(e.timestamp),_r=e=>"".concat(e.key,"-").concat(e.value),Ar=Object(fn.a)(e=>({cell:{paddingTop:e.spacing(1),paddingBottom:e.spacing(1),wordBreak:"break-all"},key:{color:e.palette.grey[500],fontWeight:e.typography.fontWeightBold},value:{fontSize:"1.05rem","white-space":"pre-line"}}));var zr=r.a.memo(({tags:e})=>{const t=Ar();return r.a.createElement(Tt.a,null,r.a.createElement(wt.a,null,r.a.createElement(Ct.a,null,e.map(e=>r.a.createElement(It.a,{key:_r(e)},r.a.createElement(Nt.a,{className:t.cell},r.a.createElement(y.a,{className:t.key,"data-testid":"SpanTags-key"},e.key),r.a.createElement(y.a,{className:t.value,"data-testid":"SpanTags-value"},e.value)))))))});const Mr=Object(fn.a)(e=>({cell:{paddingTop:e.spacing(1),paddingBottom:e.spacing(1),wordBreak:"break-all"}}));var Br=r.a.memo(({annotation:e})=>{const t=Mr(),{i18n:a}=Object(o.useLingui)();return r.a.createElement(y.a,null,r.a.createElement(y.a,{fontSize:"1.1rem",mb:.5},e.value),r.a.createElement(Tt.a,null,r.a.createElement(wt.a,null,r.a.createElement(Ct.a,{"data-testid":"span-annotation--table-body"},[{label:a._(a._("Start Time")),value:bn(e.timestamp)},{label:a._(a._("Relative Time")),value:e.relativeTime},{label:a._(a._("Address")),value:e.endpoint}].map(e=>r.a.createElement(It.a,{key:e.label},r.a.createElement(Nt.a,{className:t.cell,"data-testid":"span-annotation--label"},e.label),r.a.createElement(Nt.a,{className:t.cell,"data-testid":"span-annotation--value"},e.value)))))))}),Fr=a(176),qr=a.n(Fr);const Vr=Object(fn.a)(e=>({svg:{stroke:e.palette.grey[500],strokeWidth:"1px"},circle:{cursor:"pointer",fill:e.palette.common.white,"&:hover":{fill:e.palette.grey[400]}},"circle--selected":{fill:e.palette.grey[400],strokeWidth:"3px"}})),Hr=r.a.memo(({serviceName:e,annotations:t,onAnnotationCircleClick:a,currentAnnotationKey:n})=>{const s=Vr();let c,i;0===t.length?(c=0,i=0):1===t.length?(c=t[0].timestamp,i=c+1):(c=$n()(t,"timestamp").timestamp,i=qr()(t,"timestamp").timestamp);const o=i-c;return r.a.createElement(y.a,{height:"50px",width:"100%",display:"flex",alignItems:"center"},r.a.createElement("svg",{width:"100%",height:"16",className:s.svg},r.a.createElement("line",{x1:"0%",x2:"100%",y1:"8px",y2:"8px"}),r.a.createElement("rect",{x:"".concat(5,"%"),y:"0",width:"".concat(90,"%"),height:"16",rx:2,ry:2,fill:nt(e)}),t.map(e=>{const t=Pr(e),i=(e.timestamp-c)/o*90+5;return r.a.createElement("circle",{key:t,cx:"".concat(i,"%"),cy:"8px",r:"6px",className:C()(s.circle,{[s["circle--selected"]]:t===n}),onClick:()=>a(e),"data-testid":"span-annotation-graph--circle"})})))});Hr.defaultProps={currentAnnotationKey:""};var Ur=Hr;var Yr=r.a.memo(({span:e})=>{const[t,a]=Object(n.useState)(),[s,c]=Object(n.useState)(!1),i=Object(n.useCallback)(e=>{s&&c(!1);const t=Pr(e);a(e=>e===t?null:t)},[s]);Object(n.useEffect)(()=>{a(null),c(!1)},[e.spanId]);const l=Object(n.useMemo)(()=>e.annotations.find(e=>Pr(e)===t),[t,e.annotations]),d=Object(n.useCallback)(()=>{s||a(null),c(e=>!e)},[s]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ur,{serviceName:e.serviceName,annotations:e.annotations,onAnnotationCircleClick:i,currentAnnotaionKey:t}),s?e.annotations.map(e=>r.a.createElement(y.a,{mt:1,key:Pr(e),"data-testid":"span-annotations--annotation"},r.a.createElement(Br,{annotation:e}))):l?r.a.createElement(y.a,{mt:1,"data-testid":"span-annotations--annotation"},r.a.createElement(Br,{annotation:l})):null,r.a.createElement(y.a,{width:"100%",display:"flex",justifyContent:"flex-end",mt:2},r.a.createElement(_.a,{variant:"contained",onClick:d,"data-testid":"span-annotations--toggle-button"},s?r.a.createElement(o.Trans,{id:"hide annotations"}):r.a.createElement(o.Trans,{id:"show all annotations"}))))});const Jr=Object(fn.a)(e=>({root:{width:"100%",borderLeft:"1px solid ".concat(e.palette.grey[300]),backgroundColor:e.palette.grey[100]},serviceName:{textTransform:"uppercase",overflowWrap:"break-word"},spanName:{color:e.palette.text.secondary,overflowWrap:"break-word"},annotationsAndTagsBox:{paddingTop:e.spacing(1),paddingLeft:e.spacing(2),paddingRight:e.spacing(2),paddingBottom:e.spacing(1.5)},annotationsAndTagsTitle:{fontWeight:"bold",marginBottom:e.spacing(.5)},spanIds:{display:"flex",justifyContent:"flex-end",paddingLeft:e.spacing(2),paddingRight:e.spacing(2),paddingTop:e.spacing(.1),paddingBottom:e.spacing(.1),fontSize:"0.8rem",borderBottom:"1px solid ".concat(e.palette.grey[300])},spanIdEntry:{display:"flex"},spanIdLabel:{color:e.palette.grey[700],marginRight:e.spacing(.25)},spanIdValue:{color:e.palette.grey[800],marginRight:e.spacing(1)}}));var Kr=r.a.memo(({span:e,minHeight:t})=>{const a=Jr(),{i18n:n}=Object(o.useLingui)(),s=r.a.createElement(y.a,{className:a.spanIds},[{label:n._(n._("Span ID")),value:e.spanId},{label:n._(n._("Parent ID")),value:e.parentId}].map(e=>r.a.createElement(y.a,{className:a.spanIdEntry},r.a.createElement(y.a,{className:a.spanIdLabel},"".concat(e.label,":")),r.a.createElement(y.a,{className:a.spanIdValue},e.value||r.a.createElement(o.Trans,{id:"None"})))));return r.a.createElement(y.a,{minHeight:t,className:a.root},r.a.createElement(y.a,{pt:2,pl:2,pr:2,pb:1.5},r.a.createElement(w.a,{variant:"h5",className:a.serviceName},e.serviceName),r.a.createElement(w.a,{variant:"h6",className:a.spanName},e.spanName)),s,r.a.createElement(y.a,{className:a.annotationsAndTagsBox},r.a.createElement(w.a,{variant:"h6",className:a.annotationsAndTagsTitle},r.a.createElement(o.Trans,{id:"Annotations"})),r.a.createElement(Yr,{span:e})),r.a.createElement(y.a,{className:a.annotationsAndTagsBox},r.a.createElement(w.a,{variant:"h6",className:a.annotationsAndTagsTitle},r.a.createElement(o.Trans,{id:"Tags"})),r.a.createElement(zr,{tags:e.tags})))});const Wr=(e,t)=>e.findIndex(e=>e.spanId===t);var Qr=r.a.memo(({traceSummary:e})=>{const t=(e=>{switch(e.length){case 0:return!1;case 1:return!0;default:return e[0].depth<e[1].depth}})(e.spans),[a,s]=Object(n.useState)(0),c=0!==a,[i,o]=Object(n.useState)(0),[l,d]=Object(n.useState)({}),[m,u]=Object(n.useState)(!0),p=m?60:100,h=Object(n.useCallback)(t=>{const a=Wr(e.spans,t);d(e=>({...e,[a]:!e[a]}))},[e.spans]),g=Object(n.useCallback)(()=>{s(0)},[]),b=Object(n.useCallback)(n=>{const r=e.spans.findIndex(e=>e.spanId===n);t&&i===r&&s(a===r?0:r),o(r),u(!0)},[i,t,e.spans,a]),f=Object(n.useMemo)(()=>{if(!t)return e.spans;const n=e.spans[a],r=[n];for(let t=a+1;t<e.spans.length;t+=1){const a=e.spans[t];if(a.depth<=n.depth)break;r.push(a)}return r},[t,a,e.spans]),v=Object(n.useMemo)(()=>{let t;return f.reduce((a,n)=>{if(t&&n.depth>t)return a;t=null,a.push(n);const r=Wr(e.spans,n.spanId);return l[r]&&(t=n.depth),a},[])},[f,l,e.spans]),E=r.a.useMemo(()=>Object.keys(l).filter(e=>!!l[e]).reduce((t,a)=>(t[e.spans[a].spanId]=!0,t),{}),[e.spans,l]),k=Object(n.useMemo)(()=>$n()(f,"timestamp").timestamp,[f]),S=Object(n.useMemo)(()=>f.map(e=>{let t=e.timestamp;return e.duration&&(t+=e.duration),t}).reduce((e,t)=>Math.max(e,t)),[f]),x=Object(n.useCallback)(()=>{u(e=>!e)},[]),O=Object(n.useCallback)(()=>{const t=v.filter(e=>!!E[e.spanId]).reduce((t,a)=>(t[Wr(e.spans,a.spanId)]=!1,t),{});d(e=>({...e,...t}))},[v,e.spans,E]),T=Object(n.useCallback)(()=>{const t=Wr(e.spans,v[0].spanId);d(e=>({...e,[t]:!0}))},[v,e.spans]);return r.a.createElement(y.a,{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column"},r.a.createElement(y.a,{boxShadow:3,zIndex:1},r.a.createElement(ur,{traceSummary:e,rootSpanIndex:a})),r.a.createElement(y.a,{height:"100%",display:"flex"},r.a.createElement(y.a,{width:"".concat(p,"%"),display:"flex",flexDirection:"column"},r.a.createElement(Dr,{startTs:k-e.spans[0].timestamp,endTs:S-e.spans[0].timestamp,isRerooted:c,isRootedTrace:t,onResetRerootButtonClick:g,isSpanDetailOpened:m,onSpanDetailToggle:x,onCollapseButtonClick:T,onExpandButtonClick:O}),r.a.createElement(y.a,{flexGrow:1,width:"100%"},r.a.createElement(Ot.a,null,({height:a,width:n})=>r.a.createElement(y.a,{height:a,width:n,overflow:"auto"},r.a.createElement(Nr,{currentSpanId:e.spans[i].spanId,spans:v,depth:e.depth,childrenHiddenSpanIds:E,isRootedTrace:t,onRowClick:b,onChildrenToggle:h,startTs:k,endTs:S}))))),r.a.createElement(y.a,{width:"".concat(100-p,"%")},r.a.createElement(Ot.a,null,({height:t,width:a})=>r.a.createElement(y.a,{height:t,width:a,overflow:"auto"},r.a.createElement(Kr,{span:e.spans[i],minHeight:t}))))))});const Zr=r.a.memo(({match:e})=>{const{traceId:t}=e.params,{isLoading:a,traceSummary:s,error:c}=Object(u.d)(e=>{var a,n,r;return{isLoading:(null===(a=e.traces.traces[t])||void 0===a?void 0:a.isLoading)||!1,traceSummary:(null===(n=e.traces.traces[t])||void 0===n?void 0:n.adjustedTrace)||void 0,error:(null===(r=e.traces.traces[t])||void 0===r?void 0:r.error)||void 0}}),i=Object(u.c)();Object(n.useEffect)(()=>{i(be(t))},[t,i]);const o=Object(n.useRef)(!0);return Object(n.useEffect)(()=>{if(o.current)o.current=!1;else if(!a&&!s){let e="No trace found";c&&c.message&&(e+=": ".concat(c.message)),i(X({message:e,severity:"error"}))}},[i,c,a,s]),a?r.a.createElement(Zt,null):s?r.a.createElement(Qr,{traceSummary:s}):null});var Gr=Object(h.g)(Zr),$r=a(44),Xr=a(135);var es=()=>Object($r.c)({[G.name]:G.reducer,[Qn.name]:Qn.reducer,[Za.name]:Za.reducer,[Wt.name]:Wt.reducer,[Xa.name]:Xa.reducer,[an.name]:an.reducer,[sn.name]:sn.reducer,[ye.name]:ye.reducer});function ts(e){return Object($r.e)(es(e),Object($r.a)(Xr.a))}var as=a(797),ns=a(792);var rs=()=>{const e=Object(u.c)(),{alert:t,alertOpen:a}=Object(u.d)(e=>e.app),s=Object(n.useCallback)(()=>e($()),[e]);return r.a.createElement(as.a,{open:a,autoHideDuration:3e3,onClose:s,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(ns.a,{elevation:6,variant:"filled",severity:t.severity},t.message))};var ss=()=>(Object(g.a)("Zipkin"),r.a.createElement(n.Suspense,{fallback:r.a.createElement(l.a,null)},r.a.createElement(Ie,null,r.a.createElement(m.a,{utils:i.a},r.a.createElement(b.a,{theme:$e},r.a.createElement(d.a,{theme:$e},r.a.createElement(Ce,null,e=>r.a.createElement(u.a,{store:ts(e)},r.a.createElement(rs,null),r.a.createElement(o.I18nProvider,{i18n:U},r.a.createElement(p.a,{basename:ee},r.a.createElement(ut,null,r.a.createElement(h.a,{exact:!0,path:"/",component:Zn}),e.dependency.enabled&&r.a.createElement(h.a,{exact:!0,path:"/dependency",component:$t}),r.a.createElement(h.a,{exact:!0,path:["/traces/:traceId","/traceViewer"],component:Gr}))))))))))));a(708);c.a.render(r.a.createElement(ss,null),document.getElementById("root"))},710:function(e,t,a){"use strict";a.r(t),a.d(t,"treeCorrectedForClockSkew",(function(){return w})),a.d(t,"getServiceName",(function(){return L})),a.d(t,"traceSummary",(function(){return H})),a.d(t,"traceSummaries",(function(){return J})),a.d(t,"detailedTraceSummary",(function(){return W}));var n=a(69),r=a.n(n),s=a(81),c=a.n(s),i=a(243),o=a.n(i);function l(e){if(e.length>16){const t=e.padStart(32,"0");return t.startsWith("0000000000000000")?t.substring(16):t}return e.padStart(16,"0")}function d(e){return e&&Object.keys(e).length>0}function m(e,t){const a={traceId:t.traceId.length>16?t.traceId:e.traceId},n=e.parentId||t.parentId;n&&(a.parentId=n),a.id=e.id;const s=e.name||t.name;s&&(a.name=s);const i=e.kind||t.kind;i&&(a.kind=i);const l=e.timestamp||t.timestamp;l&&(a.timestamp=l);const m=e.duration||t.duration;m&&(a.duration=m);const u={...e.localEndpoint,...t.localEndpoint};d(u)&&(a.localEndpoint=u);const p={...e.remoteEndpoint,...t.remoteEndpoint};return d(p)&&(a.remoteEndpoint=p),0===e.annotations.length?a.annotations=t.annotations:0===t.annotations.length?a.annotations=e.annotations:a.annotations=c()(o()(e.annotations,t.annotations,r.a),["timestamp","value"]),a.tags={...e.tags,...t.tags},(e.debug||t.debug)&&(a.debug=!0),(e.shared||t.shared)&&(a.shared=!0),a}function u(e,t){return e||t?e?t?(e>t)-(e<t):1:-1:0}function p(e){return"undefined"===typeof e}function h(e,t){const a=p(e.shared)||!e.shared,n=p(t.shared)||!t.shared;return a&&n?"CLIENT"===e.kind?-1:1:a?-1:n?1:0}function g(e,t){const a=u(e.id,t.id);if(0!==a)return a;const n=h(e,t);return 0!==n?n:function(e,t){if(p(e))return-1;if(p(t))return 1;const a=u(e.serviceName,t.serviceName);if(0!==a)return a;const n=u(e.ipv4,t.ipv4);return 0!==n?n:u(e.ipv6,t.ipv6)}(e.localEndpoint,t.localEndpoint)}function b(e,t){return!e.parentId&&t.parentId?-1:e.parentId&&!t.parentId?1:e.id===t.id?h(e,t):u(e.timestamp,t.timestamp)||u(e.name,t.name)}function f(e){let{length:t}=e;if(0===t)return e;const a=[];let n,s;if(e.forEach(e=>{const t=function(e){const t={traceId:l(e.traceId)},a=e.id.padStart(16,"0");if(e.parentId){const n=e.parentId.padStart(16,"0");n!==a&&(t.parentId=n)}return t.id=a,e.name&&""!==e.name&&"unknown"!==e.name&&(t.name=e.name),e.kind&&(t.kind=e.kind),e.timestamp&&(t.timestamp=e.timestamp),e.duration&&(t.duration=e.duration),d(e.localEndpoint)&&(t.localEndpoint={...e.localEndpoint}),d(e.remoteEndpoint)&&(t.remoteEndpoint={...e.remoteEndpoint}),t.annotations=e.annotations?e.annotations.slice(0):[],t.annotations.length>1&&(t.annotations=c()(o()(t.annotations,r.a),["timestamp","value"])),t.tags=e.tags||{},e.debug&&(t.debug=!0),e.shared&&"CLIENT"!==e.kind&&(t.shared=!0),t}(e);n&&32===n.length||(n=t.traceId),a.push(t)}),t<=1)return a;a.sort(g);for(let r=0;r<t;r+=1){let e=a[r];e.traceId.length!==n.length&&(e.traceId=n);const c=e.localEndpoint?{...e.localEndpoint}:{};for(;r+1<t;){const n=a[r+1];if(n.id!==e.id)break;if(e.shared!==n.shared||(i=c,(u=n.localEndpoint)&&(i.serviceName&&u.serviceName&&i.serviceName!==u.serviceName||i.ipv4&&u.ipv4&&i.ipv4!==u.ipv4||i.ipv6&&u.ipv6&&i.ipv6!==u.ipv6||i.port&&u.port&&i.port!==u.port||(i.serviceName||(i.serviceName=u.serviceName),i.ipv4||(i.ipv4=u.ipv4),i.ipv6||(i.ipv6=u.ipv6),i.port||(i.port=u.portAsInt),0))))break;e=m(e,n),t-=1,a.splice(r+1,1)}s&&s.id===e.id&&("CLIENT"!==s.kind||"SERVER"!==e.kind||e.shared||(e.shared=!0),e.shared&&!e.parentId&&s.parentId&&(e.parentId=s.parentId)),s=e,a[r]=e}var i,u;const p=a.sort(b);return p[0].parentId||!p[0].shared||(1===p.length||p[1].parentId)&&delete p[0].shared,p}class v{constructor(e){this._parent=void 0,this._span=e,this._children=[]}get parent(){return this._parent}_setParent(e){this._parent=e}get span(){return this._span}get children(){return this._children}setSpan(e){if(!e)throw new Error("span was undefined");this._span=e}addChild(e){if(!e)throw new Error("child was undefined");if(e===this)throw new Error("circular dependency on ".concat(this.toString()));e._setParent(this),this._children.push(e)}queueRootMostSpans(){const e=[];if("undefined"===typeof this.span?this.children.forEach(t=>e.push(t)):e.push(this),0===e.length)throw new Error("Trace was empty");return e}traverse(e){const t=this.queueRootMostSpans();for(;t.length>0;){const a=t.shift();e(a.span);const{children:n}=a;for(let e=0;e<n.length;e+=1)t.push(n[e])}}toString(){return this._span?"SpanNode(".concat(JSON.stringify(this._span),")"):"SpanNode()"}}function E(e,t=!1,a){if(!t)return e;const n=a?JSON.stringify(a):"x";return"".concat(e,"-").concat(n)}function y(e,t){return u(e.span.timestamp,t.span.timestamp)}class k{constructor(e){const{debug:t=!1}=e;this._debug=t,this._rootSpan=void 0,this._keyToNode={},this._spanToParent={}}_index(e){let t,a;e.shared?(t=E(e.id,!0,e.localEndpoint),a=e.id):(t=e.id,a=e.parentId),this._spanToParent[t]=a}_process(e){const t=e.localEndpoint,a=E(e.id,e.shared,e.localEndpoint),n=t?E(e.id,e.shared):a;let r;if(e.shared)r=e.id;else if(e.parentId)r=E(e.parentId,!0,t),this._spanToParent[r]?this._spanToParent[n]=r:r=e.parentId;else if(this._rootSpan&&this._debug){const t="attributing span missing parent to root";console.log("".concat(t,": traceId=").concat(e.traceId,", rootId=").concat(this._rootSpan.span.id,", id=").concat(e.id))}const s=new v(e);r||this._rootSpan?e.shared?(this._keyToNode[a]=s,this._keyToNode[n]=s):this._keyToNode[n]=s:(this._rootSpan=s,delete this._spanToParent[n])}build(e){if(0===e.length)throw new Error("Trace was empty");const t=f(e),{length:a}=t,[{traceId:n}]=t;this._debug&&console.log("building trace tree: traceId=".concat(n));for(let r=0;r<a;r+=1)this._index(t[r]);for(let r=0;r<a;r+=1)this._process(t[r]);return this._rootSpan||(this._debug&&console.log("substituting dummy node for missing root span: traceId=".concat(n)),this._rootSpan=new v),Object.keys(this._spanToParent).forEach(e=>{const t=this._keyToNode[e],a=this._keyToNode[this._spanToParent[e]];a?a.addChild(t):this._rootSpan.addChild(t)}),function(e){const t=[];for(t.push(e);t.length>0;){const e=t.shift();(a=e).children.length>0&&a.children.sort(y);const{children:n}=e;for(let a=0;a<n.length;a+=1)t.push(n[a])}var a}(this._rootSpan),this._rootSpan}}class S{constructor(e){const{endpoint:t,skew:a}=e;this._endpoint=t,this._skew=a}get endpoint(){return this._endpoint}get skew(){return this._skew}}function x(e,t){return!(!e||!t)&&(!(!e.ipv6||!t.ipv6||e.ipv6!==t.ipv6)||!(!e.ipv4&&!t.ipv4)&&e.ipv4===t.ipv4)}function O(e,t){if(!x(t.endpoint,e.localEndpoint))return e;const a={...e};e.timestamp&&(a.timestamp=e.timestamp-t.skew);const n=e.annotations.length;n>0&&(a.annotations=[]);for(let r=0;r<n;r+=1){const n=e.annotations[r];a.annotations[r]={timestamp:n.timestamp-t.skew,value:n.value}}return a}function T(e,t){t&&e.setSpan(O(e.span,t));let a=function(e){const t=e.parent?e.parent.span:void 0,a=e.span;if(!t)return;if("CLIENT"!==t.kind||"SERVER"!==a.kind)return;let n=!1;const r=t.timestamp,s=a.timestamp;if(!r||!s)return;if(s>r)return;const c=t.duration,i=a.duration;c&&i||(n=!0);const o=a.localEndpoint;if(!o)return;const l=t.localEndpoint;if(!l)return;if(x(o,l))return;if(n){const e=s-r;if(e>0)return;return new S({endpoint:o,skew:e-1})}if(c<i){return new S({endpoint:o,skew:s-r-1})}const d=(c-i)/2;if(d<0)return;const m=s-d-r;return 0!==m?new S({endpoint:o,skew:m}):void 0}(e);a?e.setSpan(O(e.span,a)):t&&(a=t),e.children.forEach(e=>T(e,a))}function w(e,t=!1){if(0===e.length)return new v;const a=new k({debug:t}).build(e);if(!a.span)return t&&console.log("skipping clock skew adjustment due to missing root span: traceId=".concat(e[0].traceId)),a;const n=a.children;for(let r=0;r<n.length;r+=1){const e=n[r].span;if(e.parentId||e.shared)continue;const{traceId:s}=e,c=e.id,i=a.span.id;if(t){const e="skipping redundant root span";console.log("".concat(e,": traceId=").concat(s,", rootSpanId=").concat(i,", spanId=").concat(c))}return a}return T(a),a}const j={};function I(e,t){return"critical"===t?t:void 0!==e.tags.error?"critical":-1!==e.annotations.findIndex(e=>"error"===e.value)?"transient":t}function N(e){if(!e)return;const{ipv4:t,ipv6:a,port:n,serviceName:r}=e;if(t||a){return(a?"[".concat(a,"]"):t)+(n?":".concat(n):"")+(r?" (".concat(r,")"):"")}return r||""}function C(e,t,a=!1){const n={isDerived:a,value:j[e.value]||e.value,timestamp:e.timestamp};return t&&(n.endpoint=t),n}function R(e,t){t&&-1===e.findIndex(e=>e===t)&&e.push(t)}function L(e){return e?e.serviceName:void 0}function D(e){return"undefined"===typeof e||null===e}function P(e,t){const[a]=e,n={spanId:a.id,serviceNames:[],annotations:[],tags:[],errorType:"none"};let r,s;return e.forEach(e=>{e.parentId&&(n.parentId=e.parentId),!e.name||n.spanName&&"SERVER"!==e.kind||(n.spanName=e.name),e.shared?(r||(r=e.timestamp),s||(s=e.duration)):(!n.timestamp&&e.timestamp&&(n.timestamp=e.timestamp),!n.duration&&e.duration&&(n.duration=e.duration));const a=L(e.localEndpoint),c=L(e.remoteEndpoint);a&&"SERVER"===e.kind?n.serviceName=a:t&&c&&"CLIENT"===e.kind&&!n.serviceName?n.serviceName=c:a&&!n.serviceName&&(n.serviceName=a),R(n.serviceNames,a),R(n.serviceNames,c),function(e){const t=N(e.localEndpoint)||void 0;let a,n,r=e.timestamp||0,s=r&&e.duration?r+e.duration:0,c=0,i=0,o=0,l=0,{kind:d}=e;const m=[];switch(e.annotations.forEach(e=>{switch(e.value){case"cs":d="CLIENT",e.timestamp<=r?r=e.timestamp:m.push(e);break;case"sr":d="SERVER",e.timestamp<=r?r=e.timestamp:m.push(e);break;case"ss":d="SERVER",e.timestamp>=s?s=e.timestamp:m.push(e);break;case"cr":d="CLIENT",e.timestamp>=s?s=e.timestamp:m.push(e);break;case"ms":d="PRODUCER",c=e.timestamp;break;case"mr":d="CONSUMER",l=e.timestamp;break;case"ws":i=e.timestamp;break;case"wr":o=e.timestamp;break;default:m.push(e)}}),d){case"CLIENT":a="Client Start",n="Client Finish";break;case"SERVER":a="Server Start",n="Server Finish";break;case"PRODUCER":a="Producer Start",n="Producer Finish",(0===r||0!==c&&c<r)&&(r=c,c=0),(0===s||0!==i&&i>s)&&(s=i,i=0);break;case"CONSUMER":(0===r||0!==o&&o<r)&&(r=o,o=0),(0===s||0!==l&&l>s)&&(s=l,l=0),0!==s||0!==o?(a="Consumer Start",n="Consumer Finish"):a="Consumer Start"}c&&m.push({timestamp:c,value:"ms"}),i&&m.push({timestamp:i,value:"ws"}),o&&m.push({timestamp:o,value:"wr"}),l&&m.push({timestamp:l,value:"mr"});const u=r&&a,p=s&&n,h=[];return u&&h.push(C({value:a,timestamp:r},t,!0)),m.forEach(e=>{u&&e.value===a||p&&e.value===n||h.push(C(e,t))}),p&&h.push(C({value:n,timestamp:s},t,!0)),h}(e).forEach(e=>function(e,t){-1===e.findIndex(e=>t.timestamp===e.timestamp&&t.value===e.value)&&e.push(t)}(n.annotations,e)),function(e){const t=N(e.localEndpoint)||void 0,a=[],n=Object.keys(e.tags);let r;switch(n.length>0&&n.forEach(n=>{const r={key:j[n]||n,value:e.tags[n]};t&&(r.endpoints=[t]),a.push(r)}),!e.kind&&0===e.annotations.length&&t&&0===n.length&&a.push({key:"Local Address",value:t}),e.kind){case"CLIENT":r="Server Address";break;case"SERVER":r="Client Address";break;case"PRODUCER":case"CONSUMER":r="Broker Address"}return e.remoteEndpoint&&a.push({key:r||"Server Address",value:N(e.remoteEndpoint)}),a}(e).forEach(e=>function(e,t){const a=e.filter(e=>t.key===e.key&&t.value===e.value);0!==a.length?0!==(t.endpoints||[]).length&&a.forEach(e=>{e.endpoints||(e.endpoints=[]),t.endpoints.forEach(t=>{-1===e.endpoints.indexOf(t)&&e.endpoints.push(t)})}):e.push(t)}(n.tags,e)),n.errorType=I(e,n.errorType),e.debug&&(n.debug=!0)}),!n.timestamp&&r&&(n.timestamp=r),!n.duration&&s&&(n.duration=s),D(n.duration)&&(n.duration=0),D(n.spanName)&&(n.spanName="unknown"),D(n.serviceName)&&(n.serviceName="unknown"),n.annotations.forEach(e=>{D(e.endpoint)&&(e.endpoint="unknown")}),n.serviceNames.sort(),n.annotations.sort((e,t)=>e.timestamp-t.timestamp),n}j.cs="Client Send",j.csf="Client Send Fragment",j.cr="Client Receive",j.crf="Client Receive Fragment",j.ms="Producer Send",j.mr="Consumer Receive",j.ss="Server Send",j.ssf="Server Send Fragment",j.sr="Server Receive",j.srf="Server Receive Fragment",j.ca="Client Address",j.ma="Broker Address",j.sa="Server Address",j.ws="Wire Send",j.wr="Wire Receive",j.lc="Local Component";var _=a(332),A=a.n(_),z=a(18),M=a.n(z);function B(e,t){e.timestamp&&(t.push(e.timestamp),e.duration&&t.push(e.timestamp+e.duration))}function F(e){return e.length>1?(e.sort(),e[e.length-1]-e[0]):0}function q(e,t,a){e[t]?e[t].push(a):e[t]=[a]}function V(e,t){return u(e.span.timestamp,t.span.timestamp)}function H(e){const t=[],a={};let n,r=0,s="none";if(e.traverse(e=>{r+=1,n=e.traceId,s=I(e,s),B(e,t),function(e,t){const a={timestamp:e.timestamp||0,duration:e.duration||0};e.localEndpoint&&e.localEndpoint.serviceName&&q(t,e.localEndpoint.serviceName,a),e.remoteEndpoint&&e.remoteEndpoint.serviceName&&q(t,e.remoteEndpoint.serviceName,a)}(e,a)}),0===t.length)throw new Error("Trace ".concat(n," is missing a timestamp"));const[c]=e.queueRootMostSpans(),i=L(c._span.localEndpoint)||L(c._span.remoteEndpoint)||"unknown",o=c._span.name||"unknown";return{traceId:n,timestamp:t[0],duration:F(t),groupedTimestamps:a,errorType:s,spanCount:r,root:{serviceName:i,spanName:o}}}function U(e,t){let a=M()(e/1e3);return t&&(a=a.utc()),a.format("MM-DD-YYYYTHH:mm:ss.SSSZZ")}function Y(e){return 0===e||"undefined"===typeof e?"":e<1e3?"".concat(e.toFixed(0),"\u03bcs"):e<1e6?"".concat((e/1e3).toFixed(e%1e3===0?0:3),"ms"):"".concat((e/1e6).toFixed(3),"s")}function J(e,t,a=!1){const n=Math.max(...t.map(e=>e.duration));return t.map(e=>{const{timestamp:t}=e,r={traceId:e.traceId,timestamp:t,startTs:U(t,a),spanCount:e.spanCount,root:e.root},s=e.duration||0;return s&&(r.width=parseInt(parseFloat(s)/parseFloat(n)*100,10),r.duration=s,r.durationStr=Y(s)),0!==Object.keys(e.groupedTimestamps).length?r.serviceSummaries=function(e){const t=Object.entries(e).map(([e,t])=>({serviceName:e,spanCount:t.length,maxSpanDuration:Math.max(...t.map(e=>e.duration))}));return A()(t,["maxSpanDuration","serviceName"],["desc","asc"]).map(e=>({serviceName:e.serviceName,spanCount:e.spanCount}))}(e.groupedTimestamps):r.serviceSummaries=[],"none"!==e.errorType&&(r.infoClass="trace-error-".concat(e.errorType)),r}).sort((e,t)=>{const a=t.duration-e.duration;return 0===a?e.traceId.localeCompare(t.traceId):a})}function K(e,t,a,n,r){if(e.childIds=r,e.depth=n+1,e.depthClass=(n-1)%6,e.duration){const t=a?e.duration/a*100:0;e.width=t<.1?.1:t,e.durationStr=Y(e.duration)}else e.width=.1,e.durationStr="";a?(e.left=(e.timestamp-t)/a*100,e.annotations.forEach(a=>{a.left=e.duration?(a.timestamp-e.timestamp)/e.duration*100:0,a.relativeTime=Y(a.timestamp-t),a.width=8})):e.left=0}function W(e){const t={};let a=e.queueRootMostSpans();const n={traceId:a[0].span.traceId,depth:0,spans:[]},{timestamp:r,duration:s}=function(e){const t=[];return e.traverse(e=>B(e,t)),{timestamp:t[0]||0,duration:F(t)}}(e);if(!r)throw new Error("Trace ".concat(n.traceId," is missing a timestamp"));for(;a.length>0;){let e=a.shift();const c=[e.span],i=[];e.children.forEach(t=>{e.span.id===t.span.id?(c.push(t.span),t.children.forEach(e=>i.push(e))):i.push(t)}),i.sort(V),a=i.concat(a);const o=i.map(e=>e.span.id);let l=1;for(;e.parent&&e.parent.span;)e.parent.span.id!==e.span.id&&(l+=1),e=e.parent;l>n.depth&&(n.depth=l);const d=0===i.length,m=P(c,d);K(m,r,s,l,o),m.serviceNames.forEach(e=>{var a,n;(a=t)[n=e]?a[n]+=1:a[n]=1}),n.spans.push(m)}n.rootSpan={};const[c]=e.queueRootMostSpans();return n.rootSpan.serviceName=L(c._span.localEndpoint)||L(c._span.remoteEndpoint)||"unknown",n.rootSpan.spanName=c._span.name||"unknown",n.serviceNameAndSpanCounts=Object.keys(t).sort().map(e=>({serviceName:e,spanCount:t[e]})),n.spansBackup=n.spans,n.timeMarkers=[0,.2,.4,.6,.8,1].map((e,t)=>({index:t,time:Y(s*e)})),n.timeMarkersBackup=n.timeMarkers,n.duration=s,n.durationStr=Y(s),n}}},[[414,1,2]]]);
//# sourceMappingURL=main.1f5ed6e2.chunk.js.map